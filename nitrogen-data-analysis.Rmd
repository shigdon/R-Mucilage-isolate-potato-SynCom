---
title: "Nitrogen Deficiency x Microbial Inoculation of Potato"
author: "Shawn Higdon"
date: "6/12/2018"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(tidyverse)
library(lsmeans)
library(cowplot)
theme_set(theme_grey())
```

# Background

# Data Analysis

## Weight Response to Treatments
```{r}

nitrogen_data <- read.csv("./Data/nitrogen-potato-expt-2018-raw.csv", header = T)
#View(nitrogen_data)
str(nitrogen_data)
summary(nitrogen_data)
```

### Subset the Data by Sample Type
```{r}
# subset the total raw data based on type of sample
nitrogen_shoot_data <- filter(nitrogen_data, Type == "Shoot")
nitrogen_root_data <- filter(nitrogen_data, Type == "Root")
nitrogen_tuber_data <- filter(nitrogen_data, Type == "Tuber")

# group the subsets for plotting later
nitrogen_shoot_data_grouped <- group_by(nitrogen_shoot_data, Genotype, N.level, Inoculation)
nitrogen_root_data_grouped <- group_by(nitrogen_root_data, Genotype, N.level, Inoculation)
nitrogen_tuber_data_grouped <- group_by(nitrogen_tuber_data, Genotype, N.level, Inoculation)

# summary of data subsets
summary(nitrogen_shoot_data)
summary(nitrogen_root_data)
summary(nitrogen_tuber_data)
```


### Analysis of All Treatments

> All treatments represented in the subsets analyzed, where subsets of the data were generated by filtering based on the type of sample (Shoot, Root or Tuber)

#### Fresh Shoot Weight Data
##### Linear Modeling
Data measurements were fit to a linear model using the `lm` function of R.
The normality of the data was assessed by visualizing parameters of each linear model in two ways:

* Normal Q-Q plots (Standardized residuals vs. Theoretical Quantiles)
* Scale - Location plots (Squareroot of Standard residuals vs. fitted values)


```{r}
# linear model of fresh shoot data
lm_nitrogen_shoots <- lm(wet.weight_mg ~ 1 + Genotype * N.level * Inoculation, nitrogen_shoot_data)
op = par(mfrow=c(1,2))
plot(lm_nitrogen_shoots, which = c(2,3))
par(op)
```

##### Anova
```{r}
anova(lm_nitrogen_shoots)
```

 

#### Fresh Tuber Weight Data
##### Linear Modeling

```{r}
# linear model of fresh shoot data
lm_nitrogen_tuber <- lm(wet.weight_mg ~ 1 + Genotype * N.level * Inoculation, nitrogen_tuber_data)
op = par(mfrow=c(1,2))
plot(lm_nitrogen_tuber, which = c(2,3))
par(op)
```

##### Anova
```{r}
anova(lm_nitrogen_tuber)
```

##### Least-Squares Means 
```{r}
summary(lsmeans(lm_nitrogen_tuber, trt.vs.ctrl ~Inoculation*N.level*Genotype, ref=7)$contrasts, infer = c(T,T))
```

**Treated vs. Mock-inoculated Control**
```{r}
plot(CLD(lsmeans(lm_nitrogen_tuber, trt.vs.ctrl ~Inoculation,ref=7)$contrasts, alpha=0.1), main="Mean Fresh Shoot Differences for Inoculated Plants vs. Mock-Control", xlab = "Difference of Mean Estimates (mg)", ylab = "Contrasts")
```

**All Pair-wise Comparisons**
```{r}
plot(CLD(lsmeans(lm_nitrogen_tuber, ~Inoculation*N.level*Genotype), alpha=0.1), main="All pairwise comparisons for Mean Fresh Tuber Weight", xlab = "Mean Weight (mg)", ylab = "Isolate ID")

CLD(lsmeans(lm_nitrogen_tuber, ~Inoculation*N.level*Genotype), alpha=0.1)

```

##### Bar Plots

###### Create Stats Functions
```{r}
# Creating a function that provides 95% CI for the data vector using a t-distribution

conf_int95 <- function(data) {
    n <- length(data)
    error <- qt(0.975, df=n-1) * sd(data, na.rm = TRUE)/sqrt(n)
    return(error)
}

# Create a function that calculates the standard error for the data

std_error <- function(data) {
  n <- length(data)
  se <- sd(data, na.rm = TRUE)/sqrt(n)
  return(se)
}

```

> Compute stats over replicates for plotting (n=4)

```{r}

stat_fw_all_shoots_n <- summarise(nitrogen_shoot_data_grouped, N=length(wet.weight_mg), Average=mean(wet.weight_mg, na.rm = TRUE), CI95=conf_int95(wet.weight_mg), SE=std_error(wet.weight_mg))

stat_fw_all_roots_n <- summarise(nitrogen_root_data_grouped, N=length(wet.weight_mg), Average=mean(wet.weight_mg, na.rm = TRUE), CI95=conf_int95(wet.weight_mg), SE=std_error(wet.weight_mg))

stat_fw_all_tubers_n <- summarise(nitrogen_tuber_data_grouped, N=length(wet.weight_mg), Average=mean(wet.weight_mg, na.rm = TRUE), CI95=conf_int95(wet.weight_mg), SE=std_error(wet.weight_mg))

# unite Genotype; N.level; Inoculation Treatments into one field.

stat_fw_all_shoots_n <- unite(stat_fw_all_shoots_n, "Trt", c("Genotype", "N.level", "Inoculation"), sep = ".")

stat_fw_all_roots_n <- unite(stat_fw_all_roots_n, "Trt", c("Genotype", "N.level", "Inoculation"), sep = ".")

stat_fw_all_tubers_n <- unite(stat_fw_all_tubers_n, "Trt", c("Genotype", "N.level", "Inoculation"), sep = ".")

```


### Subset the Data by Nitrogen Treatment Level 
```{r}
# subset the total raw data, selecting high N treatment and type of sample
high_nitrogen_shoot_data <- filter(nitrogen_data, Type == "Shoot", N.level == "N1")
high_nitrogen_root_data <- filter(nitrogen_data, Type == "Root", N.level == "N1")
high_nitrogen_tuber_data <- filter(nitrogen_data, Type == "Tuber", N.level == "N1")

# subset the total raw data, selecting low N treatment and type of sample
low_nitrogen_shoot_data <- filter(nitrogen_data, Type == "Shoot", N.level == "N2")
low_nitrogen_root_data <- filter(nitrogen_data, Type == "Root", N.level == "N2")
low_nitrogen_tuber_data <- filter(nitrogen_data, Type == "Tuber", N.level == "N2")

# create grouped data frames for plotting later
N1_shoots_grouped <- group_by(high_nitrogen_shoot_data, Genotype, N.level, Inoculation)
N1_roots_grouped <- group_by(high_nitrogen_root_data, Genotype, N.level, Inoculation)
N1_tubers_grouped <- group_by(high_nitrogen_tuber_data, Genotype, N.level, Inoculation)

N2_shoots_grouped <- group_by(low_nitrogen_shoot_data, Genotype, N.level, Inoculation)
N2_roots_grouped <- group_by(low_nitrogen_root_data, Genotype, N.level, Inoculation)
N2_tubers_grouped <- group_by(low_nitrogen_tuber_data, Genotype, N.level, Inoculation)

# summary of data subsets
#summary(high_nitrogen_shoot_data)
#summary(high_nitrogen_root_data)
#summary(high_nitrogen_tuber_data)
#summary(low_nitrogen_shoot_data)
#summary(low_nitrogen_root_data)
#summary(low_nitrogen_tuber_data)
```

# Groupwise Analysis

> Rep 1 was close to the cooler pad during the N-deficiency experiment. Data was analyzed without Rep 1 for a total of 3 replications

## Subset Data & exclude Rep 1
```{r}
# subset the High N (N1) datasets, removing Rep 1
N1_shoot_noR1 <- filter(N1_shoots_grouped, Rep != "R1")
N1_root_noR1 <- filter(N1_roots_grouped, Rep != "R1")
N1_tuber_noR1 <- filter(N1_tubers_grouped, Rep != "R1")

# subset the Low N (N2) datasets, removing Rep 1
N2_shoot_noR1 <- filter(N2_shoots_grouped, Rep != "R1")
N2_root_noR1 <- filter(N2_roots_grouped, Rep != "R1")
N2_tuber_noR1 <- filter(N2_tubers_grouped, Rep != "R1")

# Make Grouped Dataframes, subset by Genotype
N1_G1_shoot <- filter(N1_shoot_noR1, Genotype == "G1") %>% group_by(Inoculation)
N1_G1_root <- filter(N1_root_noR1, Genotype == "G1") %>% group_by(Inoculation)
N1_G1_tuber <- filter(N1_tuber_noR1, Genotype == "G1") %>% group_by(Inoculation)
N1_G2_shoot <- filter(N1_shoot_noR1, Genotype == "G2") %>% group_by(Inoculation)
N1_G2_root <- filter(N1_root_noR1, Genotype == "G2") %>% group_by(Inoculation)
N1_G2_tuber <- filter(N1_tuber_noR1, Genotype == "G2") %>% group_by(Inoculation)

N2_G1_shoot <- filter(N2_shoot_noR1, Genotype == "G1") %>% group_by(Inoculation)
N2_G1_root <- filter(N2_root_noR1, Genotype == "G1") %>% group_by(Inoculation)
N2_G1_tuber <- filter(N2_tuber_noR1, Genotype == "G1") %>% group_by(Inoculation)
N2_G2_shoot <- filter(N2_shoot_noR1, Genotype == "G2") %>% group_by(Inoculation)
N2_G2_root <- filter(N2_root_noR1, Genotype == "G2") %>% group_by(Inoculation)
N2_G2_tuber <- filter(N2_tuber_noR1, Genotype == "G2") %>% group_by(Inoculation)

# Tuber Number Data
nitrogen_tuber_data <- read.csv("./Data/nitrogen-potato-expt-2018-tuber.csv", header = T)
high_nitrogen_tub_num_data <- filter(nitrogen_tuber_data, N.level == "N1")
low_nitrogen_tub_num_data <- filter(nitrogen_tuber_data, N.level == "N2")
N1_tub_num_grouped <- group_by(high_nitrogen_tub_num_data, Genotype, N.level, Inoculation)
N2_tub_num_grouped <- group_by(low_nitrogen_tub_num_data, Genotype, N.level, Inoculation)

N1_G1_tub_num <- filter(N1_tub_num_grouped, Genotype == "G1") %>% group_by(Inoculation)
N1_G2_tub_num <- filter(N1_tub_num_grouped, Genotype == "G2") %>% group_by(Inoculation)
N2_G1_tub_num <- filter(N2_tub_num_grouped, Genotype == "G1") %>% group_by(Inoculation)
N2_G2_tub_num <- filter(N2_tub_num_grouped, Genotype == "G2") %>% group_by(Inoculation)

```

## EMMeans

> Calculate estimated marginal means for all groups and compare effects of inoculation.

### Shoot Weight
#### High N, G1
##### Linear Modeling
```{r}
# linear model of fresh shoot data
lm_N1_G1_shoot <- lm(wet.weight_mg ~ 1 + Inoculation, N1_G1_shoot)
op = par(mfrow=c(1,2))
plot(lm_N1_G1_shoot, which = c(2,3))
par(op)
```

##### Anova
```{r}
anova(lm_N1_G1_shoot)
```

##### EMM Plots

**All Pairwise Comparisons**
```{r}
emm.n1.g1.shoot <- emmeans(lm_N1_G1_shoot, ~ Inoculation)


pairs(emm.n1.g1.shoot)
# plot means with confidence intervals

pdf("./emmeans_plots/hiN_shoot/emm.n1.g1.shoot.CI.plot.pdf")
emm.n1.g1.shoot.CIplot <- plot(emm.n1.g1.shoot,
                               comparisons = TRUE,
                               xlab = "Average Shoot Weight Under High-N (g)",
                               ylab = "Inoculation Treatment")
emm.n1.g1.shoot.CIplot
dev.off()
emm.n1.g1.shoot.CIplot

# Pairwise P-Value Plot
n1.g1.shoot.pwpp <- pwpp(emm.n1.g1.shoot) # Pairwise P-value Plot

n1.g1.shoot.pwpp <- n1.g1.shoot.pwpp + labs(title = "High Nitrogen, Russett Burbank  (n = 6)",
                                                  x = "Tukey-adjusted P value",
                                                  y = "Average Weight (g)") +
  theme(plot.title = element_text(size = 16, hjust = 0.5),
        axis.text.x = element_text(size = 10),
        axis.text.y = element_text(size = 10),
        axis.title.x = element_text(size = 14),
        axis.title.y = element_text(size = 14))

n1.g1.shoot.pwpp

ggsave("./emmeans_plots/hiN_shoot/n1.g1.shoot.pwpp.pdf", n1.g1.shoot.pwpp)

```

##### EMM trt. vs. ctrl
```{r}
emmeans(lm_N1_G1_shoot, specs = trt.vs.ctrl ~ Inoculation, ref = 7)
```

#### High N, G2

##### Linear Modeling
```{r}
# linear model of fresh shoot data
lm_N1_G2_shoot <- lm(wet.weight_mg ~ 1 + Inoculation, N1_G2_shoot)
op = par(mfrow=c(1,2))
plot(lm_N1_G2_shoot, which = c(2,3))
par(op)
```

##### Anova
```{r}
anova(lm_N1_G2_shoot)
```

##### EMM Plots

**All Pairwise Comparisons**
```{r}
emm.n1.G2.shoot <- emmeans(lm_N1_G2_shoot, ~ Inoculation)

pairs(emm.n1.G2.shoot)

# plot means with confidence intervals

pdf("./emmeans_plots/hiN_shoot/emm.n1.G2.shoot.CI.plot.pdf")
emm.n1.G2.shoot.CIplot <- plot(emm.n1.G2.shoot,
                               comparisons = TRUE,
                               xlab = "Average Shoot Weight Under High-N (g)",
                               ylab = "Inoculation Treatment")
emm.n1.G2.shoot.CIplot
dev.off()
emm.n1.G2.shoot.CIplot

# Pairwise P-Value Plot
n1.G2.shoot.pwpp <- pwpp(emm.n1.G2.shoot) # Pairwise P-value Plot

n1.G2.shoot.pwpp <- n1.G2.shoot.pwpp + labs(title = "High Nitrogen, Red La Soda  (n = 6)",
                                                  x = "Tukey-adjusted P value",
                                                  y = "Average Weight (g)") +
  theme(plot.title = element_text(size = 16, hjust = 0.5),
        axis.text.x = element_text(size = 10),
        axis.text.y = element_text(size = 10),
        axis.title.x = element_text(size = 14),
        axis.title.y = element_text(size = 14))

n1.G2.shoot.pwpp

ggsave("./emmeans_plots/hiN_shoot/n1.G2.shoot.pwpp.pdf", n1.G2.shoot.pwpp)

```

##### EMM trt. vs. ctrl
```{r}
emmeans(lm_N1_G2_shoot, specs = trt.vs.ctrl ~ Inoculation, ref = 7)
```

#### Low N, G1
##### Linear Modeling
```{r}
# linear model of fresh shoot data
lm_N2_G1_shoot <- lm(wet.weight_mg ~ 1 + Inoculation, N2_G1_shoot)
op = par(mfrow=c(1,2))
plot(lm_N2_G1_shoot, which = c(2,3))
par(op)
```

##### Anova
```{r}
anova(lm_N2_G1_shoot)
```

##### EMM Plots

**All Pairwise Comparisons**
```{r}
emm.N2.G1.shoot <- emmeans(lm_N2_G1_shoot, ~ Inoculation)

pairs(emm.N2.G1.shoot)
# plot means with confidence intervals

pdf("./emmeans_plots/lowN_shoot/emm.N2.G1.shoot.CI.plot.pdf")
emm.N2.G1.shoot.CIplot <- plot(emm.N2.G1.shoot,
                               comparisons = TRUE,
                               xlab = "Average Shoot Weight Under Low-N (g)",
                               ylab = "Inoculation Treatment")
emm.N2.G1.shoot.CIplot
dev.off()
emm.N2.G1.shoot.CIplot

# Pairwise P-Value Plot
N2.G1.shoot.pwpp <- pwpp(emm.N2.G1.shoot) # Pairwise P-value Plot

N2.G1.shoot.pwpp <- N2.G1.shoot.pwpp + labs(title = "Low Nitrogen, Russett Burbank  (n = 6)",
                                                  x = "Tukey-adjusted P value",
                                                  y = "Average Weight (g)") +
  theme(plot.title = element_text(size = 16, hjust = 0.5),
        axis.text.x = element_text(size = 10),
        axis.text.y = element_text(size = 10),
        axis.title.x = element_text(size = 14),
        axis.title.y = element_text(size = 14))

N2.G1.shoot.pwpp

ggsave("./emmeans_plots/lowN_shoot/N2.G1.shoot.pwpp.pdf", N2.G1.shoot.pwpp)

```

##### EMM trt. vs. ctrl
```{r}
emmeans(lm_N2_G1_shoot, specs = trt.vs.ctrl ~ Inoculation, ref = 7)
```

#### Low N, G2
##### Linear Modeling
```{r}
# linear model of fresh shoot data
lm_N2_G2_shoot <- lm(wet.weight_mg ~ 1 + Inoculation, N2_G2_shoot)
op = par(mfrow=c(1,2))
plot(lm_N2_G2_shoot, which = c(2,3))
par(op)
```

##### Anova
```{r}
anova(lm_N2_G2_shoot)
```

##### EMM Plots

**All Pair-wise Comparisons**
```{r}
emm.N2.G2.shoot <- emmeans(lm_N2_G2_shoot, ~ Inoculation)

pairs(emm.N2.G2.shoot)
# plot means with confidence intervals

pdf("./emmeans_plots/lowN_shoot/emm.N2.G2.shoot.CI.plot.pdf")
emm.N2.G2.shoot.CIplot <- plot(emm.N2.G2.shoot,
                               comparisons = TRUE,
                               xlab = "Average Shoot Weight Under Low-N (g)",
                               ylab = "Inoculation Treatment")
emm.N2.G2.shoot.CIplot
dev.off()
emm.N2.G2.shoot.CIplot

# Pairwise P-Value Plot
N2.G2.shoot.pwpp <- pwpp(emm.N2.G2.shoot) # Pairwise P-value Plot

N2.G2.shoot.pwpp <- N2.G2.shoot.pwpp + labs(title = "Low Nitrogen, Red La Soda  (n = 6)",
                                                  x = "Tukey-adjusted P value",
                                                  y = "Average Weight (g)") +
  theme(plot.title = element_text(size = 16, hjust = 0.5),
        axis.text.x = element_text(size = 10),
        axis.text.y = element_text(size = 10),
        axis.title.x = element_text(size = 14),
        axis.title.y = element_text(size = 14))

N2.G2.shoot.pwpp

ggsave("./emmeans_plots/lowN_shoot/N2.G2.shoot.pwpp.pdf", N2.G2.shoot.pwpp)

```

##### EMM trt. vs. ctrl
```{r}
emmeans(lm_N1_G2_shoot, specs = trt.vs.ctrl ~ Inoculation, ref = 7)
```

### Root Weight
#### High N, G1
##### Linear Modeling
```{r}
# linear model of fresh root data
lm_N1_G1_root <- lm(wet.weight_mg ~ 1 + Inoculation, N1_G1_root)
op = par(mfrow=c(1,2))
plot(lm_N1_G1_root, which = c(2,3))
par(op)
```

##### Anova
```{r}
anova(lm_N1_G1_root)
```

##### EMM Plots

**All Pair-wise Comparisons**
```{r}
emm.n1.g1.root <- emmeans(lm_N1_G1_root, ~ Inoculation)
pairs(emm.n1.g1.root)
# plot means with confidence intervals

pdf("./emmeans_plots/hiN_root/emm.n1.g1.root.CI.plot.pdf")
emm.n1.g1.root.CIplot <- plot(emm.n1.g1.root,
                               comparisons = TRUE,
                               xlab = "Average Root Weight Under High-N (g)",
                               ylab = "Inoculation Treatment")
emm.n1.g1.root.CIplot
dev.off()
emm.n1.g1.root.CIplot

# Pairwise P-Value Plot
n1.g1.root.pwpp <- pwpp(emm.n1.g1.root) # Pairwise P-value Plot

n1.g1.root.pwpp <- n1.g1.root.pwpp + labs(title = "High Nitrogen, Russett Burbank  (n = 6)",
                                                  x = "Tukey-adjusted P value",
                                                  y = "Average Weight (g)") +
  theme(plot.title = element_text(size = 16, hjust = 0.5),
        axis.text.x = element_text(size = 10),
        axis.text.y = element_text(size = 10),
        axis.title.x = element_text(size = 14),
        axis.title.y = element_text(size = 14))

n1.g1.root.pwpp

ggsave("./emmeans_plots/hiN_root/n1.g1.root.pwpp.pdf", n1.g1.root.pwpp)

```

##### EMM trt. vs. ctrl
```{r}
emmeans(lm_N1_G1_root, specs = trt.vs.ctrl ~ Inoculation, ref = 7)
```

#### High N, G2
##### Linear Modeling
```{r}
# linear model of fresh root data
lm_N1_G2_root <- lm(wet.weight_mg ~ 1 + Inoculation, N1_G2_root)
op = par(mfrow=c(1,2))
plot(lm_N1_G2_root, which = c(2,3))
par(op)
```

##### Anova
```{r}
anova(lm_N1_G2_root)
```

##### EMM Plots

**All Pairwise Comparisons**
```{r}
emm.n1.G2.root <- emmeans(lm_N1_G2_root, ~ Inoculation)
pairs(emm.n1.G2.root)
# plot means with confidence intervals

pdf("./emmeans_plots/hiN_root/emm.n1.G2.root.CI.plot.pdf")
emm.n1.G2.root.CIplot <- plot(emm.n1.G2.root,
                               comparisons = TRUE,
                               xlab = "Average Root Weight Under High-N (g)",
                               ylab = "Inoculation Treatment")
emm.n1.G2.root.CIplot
dev.off()
emm.n1.G2.root.CIplot

# Pairwise P-Value Plot
n1.G2.root.pwpp <- pwpp(emm.n1.G2.root) # Pairwise P-value Plot

n1.G2.root.pwpp <- n1.G2.root.pwpp + labs(title = "High Nitrogen, Red La Soda  (n = 6)",
                                                  x = "Tukey-adjusted P value",
                                                  y = "Average Weight (g)") +
  theme(plot.title = element_text(size = 16, hjust = 0.5),
        axis.text.x = element_text(size = 10),
        axis.text.y = element_text(size = 10),
        axis.title.x = element_text(size = 14),
        axis.title.y = element_text(size = 14))

n1.G2.root.pwpp

ggsave("./emmeans_plots/hiN_root/n1.G2.root.pwpp.pdf", n1.G2.root.pwpp)

```

##### EMM trt. vs. ctrl
```{r}
emmeans(lm_N1_G2_root, specs = trt.vs.ctrl ~ Inoculation, ref = 7)
```

#### Low N, G1
##### Linear Modeling
```{r}
# linear model of fresh root data
lm_N2_G1_root <- lm(wet.weight_mg ~ 1 + Inoculation, N2_G1_root)
op = par(mfrow=c(1,2))
plot(lm_N2_G1_root, which = c(2,3))
par(op)
```

##### Anova
```{r}
anova(lm_N2_G1_root)
```

##### EMM Plots

**All Pair-wise Comparisons**
```{r}
emm.N2.G1.root <- emmeans(lm_N2_G1_root, ~ Inoculation)
pairs(emm.N2.G1.root)
# plot means with confidence intervals

pdf("./emmeans_plots/lowN_root/emm.N2.G1.root.CI.plot.pdf")
emm.N2.G1.root.CIplot <- plot(emm.N2.G1.root,
                               comparisons = TRUE,
                               xlab = "Average Root Weight Under Low-N (g)",
                               ylab = "Inoculation Treatment")
emm.N2.G1.root.CIplot
dev.off()
emm.N2.G1.root.CIplot

# Pairwise P-Value Plot
N2.G1.root.pwpp <- pwpp(emm.N2.G1.root) # Pairwise P-value Plot

N2.G1.root.pwpp <- N2.G1.root.pwpp + labs(title = "Low Nitrogen, Russett Burbank  (n = 6)",
                                                  x = "Tukey-adjusted P value",
                                                  y = "Average Weight (g)") +
  theme(plot.title = element_text(size = 16, hjust = 0.5),
        axis.text.x = element_text(size = 10),
        axis.text.y = element_text(size = 10),
        axis.title.x = element_text(size = 14),
        axis.title.y = element_text(size = 14))

N2.G1.root.pwpp

ggsave("./emmeans_plots/lowN_root/N2.G1.root.pwpp.pdf", N2.G1.root.pwpp)

```

##### EMM trt. vs. ctrl
```{r}
emmeans(lm_N2_G1_root, specs = trt.vs.ctrl ~ Inoculation, ref = 7)
```

#### Low N, G2
##### Linear Modeling
```{r}
# linear model of fresh root data
lm_N2_G2_root <- lm(wet.weight_mg ~ 1 + Inoculation, N2_G2_root)
op = par(mfrow=c(1,2))
plot(lm_N2_G2_root, which = c(2,3))
par(op)
```

##### Anova
```{r}
anova(lm_N2_G2_root)
```

##### EMM Plots

**All Pair-wise Comparisons**
```{r}
emm.N2.G2.root <- emmeans(lm_N2_G2_root, ~ Inoculation)
pairs(emm.N2.G2.root)
# plot means with confidence intervals

pdf("./emmeans_plots/lowN_root/emm.N2.G2.root.CI.plot.pdf")
emm.N2.G2.root.CIplot <- plot(emm.N2.G2.root,
                               comparisons = TRUE,
                               xlab = "Average Root Weight Under Low-N (g)",
                               ylab = "Inoculation Treatment")
emm.N2.G2.root.CIplot
dev.off()
emm.N2.G2.root.CIplot

# Pairwise P-Value Plot
N2.G2.root.pwpp <- pwpp(emm.N2.G2.root) # Pairwise P-value Plot

N2.G2.root.pwpp <- N2.G2.root.pwpp + labs(title = "Low Nitrogen, Red La Soda  (n = 6)",
                                                  x = "Tukey-adjusted P value",
                                                  y = "Average Dry Weight (g)") +
  theme(plot.title = element_text(size = 16, hjust = 0.5),
        axis.text.x = element_text(size = 10),
        axis.text.y = element_text(size = 10),
        axis.title.x = element_text(size = 14),
        axis.title.y = element_text(size = 14))

N2.G2.root.pwpp

ggsave("./emmeans_plots/lowN_root/N2.G2.root.pwpp.pdf", N2.G2.root.pwpp)

```

##### EMM trt. vs. ctrl
```{r}
emmeans(lm_N2_G2_root, specs = trt.vs.ctrl ~ Inoculation, ref = 7)
```

### Tuber Weight
#### High N, G1
##### Linear Modeling
```{r}
# linear model of fresh tuber data
lm_N1_G1_tuber <- lm(wet.weight_mg ~ 1 + Inoculation, N1_G1_tuber)
op = par(mfrow=c(1,2))
plot(lm_N1_G1_tuber, which = c(2,3))
par(op)
```

##### Anova
```{r}
anova(lm_N1_G1_tuber)
```

##### EMM Plots

**All Pair-wise Comparisons**
```{r}
emm.n1.g1.tuber <- emmeans(lm_N1_G1_tuber, ~ Inoculation)
pairs(emm.n1.g1.tuber)
# plot means with confidence intervals

pdf("./emmeans_plots/hiN_tuber/emm.n1.g1.tuber.CI.plot.pdf")
emm.n1.g1.tuber.CIplot <- plot(emm.n1.g1.tuber,
                               comparisons = TRUE,
                               xlab = "Average Tuber Weight Under High-N (g)",
                               ylab = "Inoculation Treatment")
emm.n1.g1.tuber.CIplot
dev.off()
emm.n1.g1.tuber.CIplot

# Pairwise P-Value Plot
n1.g1.tuber.pwpp <- pwpp(emm.n1.g1.tuber) # Pairwise P-value Plot

n1.g1.tuber.pwpp <- n1.g1.tuber.pwpp + labs(title = "High Nitrogen, Russett Burbank  (n = 6)",
                                                  x = "Tukey-adjusted P value",
                                                  y = "Average Weight (g)") +
  theme(plot.title = element_text(size = 16, hjust = 0.5),
        axis.text.x = element_text(size = 10),
        axis.text.y = element_text(size = 10),
        axis.title.x = element_text(size = 14),
        axis.title.y = element_text(size = 14))

n1.g1.tuber.pwpp

ggsave("./emmeans_plots/hiN_tuber/n1.g1.tuber.pwpp.pdf", n1.g1.tuber.pwpp)

```

##### EMM trt. vs. ctrl
```{r}
emmeans(lm_N1_G1_tuber, specs = trt.vs.ctrl ~ Inoculation, ref = 7)
```

#### High N, G2
##### Linear Modeling
```{r}
# linear model of fresh tuber data
lm_N1_G2_tuber <- lm(wet.weight_mg ~ 1 + Inoculation, N1_G2_tuber)
op = par(mfrow=c(1,2))
plot(lm_N1_G2_tuber, which = c(2,3))
par(op)
```

##### Anova
```{r}
anova(lm_N1_G2_tuber)
```

##### EMM Plots

**All Pair-wise Comparisons**
```{r}
emm.n1.G2.tuber <- emmeans(lm_N1_G2_tuber, ~ Inoculation)
pairs(emm.n1.G2.tuber)
# plot means with confidence intervals

pdf("./emmeans_plots/hiN_tuber/emm.n1.G2.tuber.CI.plot.pdf")
emm.n1.G2.tuber.CIplot <- plot(emm.n1.G2.tuber,
                               comparisons = TRUE,
                               xlab = "Average Tuber Weight Under High-N (g)",
                               ylab = "Inoculation Treatment")
emm.n1.G2.tuber.CIplot
dev.off()
emm.n1.G2.tuber.CIplot

# Pairwise P-Value Plot
n1.G2.tuber.pwpp <- pwpp(emm.n1.G2.tuber) # Pairwise P-value Plot

n1.G2.tuber.pwpp <- n1.G2.tuber.pwpp + labs(title = "High Nitrogen, Red La Soda  (n = 6)",
                                                  x = "Tukey-adjusted P value",
                                                  y = "Average Weight (g)") +
  theme(plot.title = element_text(size = 16, hjust = 0.5),
        axis.text.x = element_text(size = 10),
        axis.text.y = element_text(size = 10),
        axis.title.x = element_text(size = 14),
        axis.title.y = element_text(size = 14))

n1.G2.tuber.pwpp

ggsave("./emmeans_plots/hiN_tuber/n1.G2.tuber.pwpp.pdf", n1.G2.tuber.pwpp)

```

##### EMM trt. vs. ctrl
```{r}
emmeans(lm_N1_G2_tuber, specs = trt.vs.ctrl ~ Inoculation, ref = 7)
```

#### Low N, G1
##### Linear Modeling
```{r}
# linear model of fresh tuber data
lm_N2_G1_tuber <- lm(wet.weight_mg ~ 1 + Inoculation, N2_G1_tuber)
op = par(mfrow=c(1,2))
plot(lm_N2_G1_tuber, which = c(2,3))
par(op)
```

##### Anova
```{r}
anova(lm_N2_G1_tuber)
```

##### EMM Plots

**All Pair-wise Comparisons**
```{r}
emm.N2.G1.tuber <- emmeans(lm_N2_G1_tuber, ~ Inoculation)
pairs(emm.N2.G1.tuber)
# plot means with confidence intervals

pdf("./emmeans_plots/lowN_tuber/emm.N2.G1.tuber.CI.plot.pdf")
emm.N2.G1.tuber.CIplot <- plot(emm.N2.G1.tuber,
                               comparisons = TRUE,
                               xlab = "Average Tuber Weight Under Low-N (g)",
                               ylab = "Inoculation Treatment")
emm.N2.G1.tuber.CIplot
dev.off()
emm.N2.G1.tuber.CIplot

# Pairwise P-Value Plot
N2.G1.tuber.pwpp <- pwpp(emm.N2.G1.tuber) # Pairwise P-value Plot

N2.G1.tuber.pwpp <- N2.G1.tuber.pwpp + labs(title = "Low Nitrogen, Russett Burbank  (n = 6)",
                                                  x = "Tukey-adjusted P value",
                                                  y = "Average Weight (g)") +
  theme(plot.title = element_text(size = 16, hjust = 0.5),
        axis.text.x = element_text(size = 10),
        axis.text.y = element_text(size = 10),
        axis.title.x = element_text(size = 14),
        axis.title.y = element_text(size = 14))

N2.G1.tuber.pwpp

ggsave("./emmeans_plots/lowN_tuber/N2.G1.tuber.pwpp.pdf", N2.G1.tuber.pwpp)

```

##### EMM trt. vs. ctrl
```{r}
emmeans(lm_N2_G1_tuber, specs = trt.vs.ctrl ~ Inoculation, ref = 7)
```

#### Low N, G2
##### Linear Modeling
```{r}
# linear model of fresh tuber data
lm_N2_G2_tuber <- lm(wet.weight_mg ~ 1 + Inoculation, N2_G2_tuber)
op = par(mfrow=c(1,2))
plot(lm_N2_G2_tuber, which = c(2,3))
par(op)
```

##### Anova
```{r}
anova(lm_N2_G2_tuber)
```

##### EMM Plots

**All Pair-wise Comparisons**
```{r}
emm.N2.G2.tuber <- emmeans(lm_N2_G2_tuber, ~ Inoculation)
pairs(emm.N2.G2.tuber)
# plot means with confidence intervals

pdf("./emmeans_plots/lowN_tuber/emm.N2.G2.tuber.CI.plot.pdf")
emm.N2.G2.tuber.CIplot <- plot(emm.N2.G2.tuber,
                               comparisons = TRUE,
                               xlab = "Average Tuber Weight Under Low-N (g)",
                               ylab = "Inoculation Treatment")
emm.N2.G2.tuber.CIplot
dev.off()
emm.N2.G2.tuber.CIplot

# Pairwise P-Value Plot
N2.G2.tuber.pwpp <- pwpp(emm.N2.G2.tuber) # Pairwise P-value Plot

N2.G2.tuber.pwpp <- N2.G2.tuber.pwpp + labs(title = "Low Nitrogen, Red La Soda  (n = 6)",
                                                  x = "Tukey-adjusted P value",
                                                  y = "Average Weight (g)") +
  theme(plot.title = element_text(size = 16, hjust = 0.5),
        axis.text.x = element_text(size = 10),
        axis.text.y = element_text(size = 10),
        axis.title.x = element_text(size = 14),
        axis.title.y = element_text(size = 14))

N2.G2.tuber.pwpp

ggsave("./emmeans_plots/lowN_tuber/N2.G2.tuber.pwpp.pdf", N2.G2.tuber.pwpp)

```

##### EMM trt. vs. ctrl
```{r}
emmeans(lm_N2_G2_tuber, specs = trt.vs.ctrl ~ Inoculation, ref = 7)
```


### Tuber Number

#### High N, G1
##### Linear Modeling
```{r}
# linear model of fresh tub_num data
lm_N1_G1_tub_num <- lm(N_tubers ~ 1 + Inoculation, N1_G1_tub_num)
op = par(mfrow=c(1,2))
plot(lm_N1_G1_tub_num, which = c(2,3))
par(op)
```

##### Anova
```{r}
anova(lm_N1_G1_tub_num)
```

##### EMM Plots

**All Pair-wise Comparisons**
```{r}
emm.n1.g1.tub_num <- emmeans(lm_N1_G1_tub_num, ~ Inoculation)
pairs(emm.n1.g1.tub_num)
# plot means with confidence intervals

pdf("./emmeans_plots/hiN_tub-num/emm.n1.g1.tub_num.CI.plot.pdf")
emm.n1.g1.tub_num.CIplot <- plot(emm.n1.g1.tub_num,
                               comparisons = TRUE,
                               xlab = "Average Tuber Number Under High-N",
                               ylab = "Inoculation Treatment")
emm.n1.g1.tub_num.CIplot
dev.off()
emm.n1.g1.tub_num.CIplot

# Pairwise P-Value Plot
n1.g1.tub_num.pwpp <- pwpp(emm.n1.g1.tub_num) # Pairwise P-value Plot

n1.g1.tub_num.pwpp <- n1.g1.tub_num.pwpp + labs(title = "High Nitrogen, Russett Burbank  (n = 6)",
                                                  x = "Tukey-adjusted P value",
                                                  y = "Average Number of Tubers") +
  theme(plot.title = element_text(size = 16, hjust = 0.5),
        axis.text.x = element_text(size = 10),
        axis.text.y = element_text(size = 10),
        axis.title.x = element_text(size = 14),
        axis.title.y = element_text(size = 14))

n1.g1.tub_num.pwpp

ggsave("./emmeans_plots/hiN_tub-num/n1.g1.tub_num.pwpp.pdf", n1.g1.tub_num.pwpp)

```

##### EMM trt. vs. ctrl
```{r}
emmeans(lm_N1_G1_tub_num, specs = trt.vs.ctrl ~ Inoculation, ref = 7)
```

#### High N, G2
##### Linear Modeling
```{r}
# linear model of fresh tub_num data
lm_N1_G2_tub_num <- lm(N_tubers ~ 1 + Inoculation, N1_G2_tub_num)
op = par(mfrow=c(1,2))
plot(lm_N1_G2_tub_num, which = c(2,3))
par(op)
```

##### Anova
```{r}
anova(lm_N1_G2_tub_num)
```

##### EMM Plots

**All Pair-wise Comparisons**
```{r}
emm.n1.G2.tub_num <- emmeans(lm_N1_G2_tub_num, ~ Inoculation)

pairs(emm.n1.G2.tub_num)

# plot means with confidence intervals

pdf("./emmeans_plots/hiN_tub-num/emm.n1.G2.tub_num.CI.plot.pdf")
emm.n1.G2.tub_num.CIplot <- plot(emm.n1.G2.tub_num,
                               comparisons = TRUE,
                               xlab = "Average Tuber Number Under High-N",
                               ylab = "Inoculation Treatment")
emm.n1.G2.tub_num.CIplot
dev.off()
emm.n1.G2.tub_num.CIplot

# Pairwise P-Value Plot
n1.G2.tub_num.pwpp <- pwpp(emm.n1.G2.tub_num) # Pairwise P-value Plot

n1.G2.tub_num.pwpp <- n1.G2.tub_num.pwpp + labs(title = "High Nitrogen, Red La Soda  (n = 6)",
                                                  x = "Tukey-adjusted P value",
                                                  y = "Average Number of Tubers") +
  theme(plot.title = element_text(size = 16, hjust = 0.5),
        axis.text.x = element_text(size = 10),
        axis.text.y = element_text(size = 10),
        axis.title.x = element_text(size = 14),
        axis.title.y = element_text(size = 14))

n1.G2.tub_num.pwpp

ggsave("./emmeans_plots/hiN_tub-num/n1.G2.tub_num.pwpp.pdf", n1.G2.tub_num.pwpp)

```

##### EMM trt. vs. ctrl
```{r}
emmeans(lm_N1_G2_tub_num, specs = trt.vs.ctrl ~ Inoculation, ref = 7)
```

#### Low N, G1
##### Linear Modeling
```{r}
# linear model of fresh tub_num data
lm_N2_G1_tub_num <- lm(N_tubers ~ 1 + Inoculation, N2_G1_tub_num)
op = par(mfrow=c(1,2))
plot(lm_N2_G1_tub_num, which = c(2,3))
par(op)
```

##### Anova
```{r}
anova(lm_N2_G1_tub_num)
```

##### EMM Plots

**All Pair-wise Comparisons**
```{r}
emm.N2.g1.tub_num <- emmeans(lm_N2_G1_tub_num, ~ Inoculation)
pairs(emm.N2.g1.tub_num)
# plot means with confidence intervals

pdf("./emmeans_plots/hiN_tub-num/emm.N2.g1.tub_num.CI.plot.pdf")
emm.N2.g1.tub_num.CIplot <- plot(emm.N2.g1.tub_num,
                               comparisons = TRUE,
                               xlab = "Average Tuber Number Under Low-N",
                               ylab = "Inoculation Treatment")
emm.N2.g1.tub_num.CIplot
dev.off()
emm.N2.g1.tub_num.CIplot

# Pairwise P-Value Plot
N2.g1.tub_num.pwpp <- pwpp(emm.N2.g1.tub_num) # Pairwise P-value Plot

N2.g1.tub_num.pwpp <- N2.g1.tub_num.pwpp + labs(title = "Low Nitrogen, Russett Burbank  (n = 6)",
                                                  x = "Tukey-adjusted P value",
                                                  y = "Average Number of Tubers") +
  theme(plot.title = element_text(size = 16, hjust = 0.5),
        axis.text.x = element_text(size = 10),
        axis.text.y = element_text(size = 10),
        axis.title.x = element_text(size = 14),
        axis.title.y = element_text(size = 14))

N2.g1.tub_num.pwpp

ggsave("./emmeans_plots/hiN_tub-num/N2.g1.tub_num.pwpp.pdf", N2.g1.tub_num.pwpp)

```

##### EMM trt. vs. ctrl
```{r}
emmeans(lm_N2_G1_tub_num, specs = trt.vs.ctrl ~ Inoculation, ref = 7)
```

#### Low N, G2
##### Linear Modeling
```{r}
# linear model of fresh tub_num data
lm_N2_G2_tub_num <- lm(N_tubers ~ 1 + Inoculation, N2_G2_tub_num)
op = par(mfrow=c(1,2))
plot(lm_N2_G2_tub_num, which = c(2,3))
par(op)
```

##### Anova
```{r}
anova(lm_N2_G2_tub_num)
```

##### EMM Plots

**All Pair-wise Comparisons**
```{r}
emm.N2.G2.tub_num <- emmeans(lm_N2_G2_tub_num, ~ Inoculation)
pairs(emm.N2.G2.tub_num)
# plot means with confidence intervals

pdf("./emmeans_plots/hiN_tub-num/emm.N2.G2.tub_num.CI.plot.pdf")
emm.N2.G2.tub_num.CIplot <- plot(emm.N2.G2.tub_num,
                               comparisons = TRUE,
                               xlab = "Average Tuber Number Under Low-N",
                               ylab = "Inoculation Treatment")
emm.N2.G2.tub_num.CIplot
dev.off()
emm.N2.G2.tub_num.CIplot

# Pairwise P-Value Plot
N2.G2.tub_num.pwpp <- pwpp(emm.N2.G2.tub_num) # Pairwise P-value Plot

N2.G2.tub_num.pwpp <- N2.G2.tub_num.pwpp + labs(title = "Low Nitrogen, Red La Soda  (n = 6)",
                                                  x = "Tukey-adjusted P value",
                                                  y = "Average Number of Tubers") +
  theme(plot.title = element_text(size = 16, hjust = 0.5),
        axis.text.x = element_text(size = 10),
        axis.text.y = element_text(size = 10),
        axis.title.x = element_text(size = 14),
        axis.title.y = element_text(size = 14))

N2.G2.tub_num.pwpp

ggsave("./emmeans_plots/hiN_tub-num/N2.G2.tub_num.pwpp.pdf", N2.G2.tub_num.pwpp)

```

##### EMM trt. vs. ctrl
```{r}
emmeans(lm_N2_G2_tub_num, specs = trt.vs.ctrl ~ Inoculation, ref = 7)
```

### Cowplot
```{r}
grid_emm_shoot <- plot_grid(as_grob(n1.g1.shoot.pwpp),
                            as_grob(N2.G1.shoot.pwpp),
                            as_grob(n1.G2.shoot.pwpp),
                            as_grob(N2.G2.shoot.pwpp),
                            row = 2,
                            ncol = 2,
                            labels = c("A", "B", "C", "D"))

grid_emm_root <- plot_grid(as_grob(n1.g1.root.pwpp),
                           as_grob(N2.G1.root.pwpp),
                           as_grob(n1.G2.root.pwpp),
                           as_grob(N2.G2.root.pwpp),
                           row = 2,
                           ncol = 2,
                           labels = c("A", "B", "C", "D"))

grid_emm_tuber <- plot_grid(as_grob(n1.g1.tuber.pwpp),
                            as_grob(N2.G1.tuber.pwpp),
                            as_grob(n1.G2.tuber.pwpp),
                            as_grob(N2.G2.tuber.pwpp),
                            row = 2,
                            ncol = 2,
                            labels = c("A", "B", "C", "D"))

grid_emm_tub_num <- plot_grid(as_grob(n1.g1.tub_num.pwpp),
                              as_grob(N2.g1.tub_num.pwpp),
                              as_grob(n1.G2.tub_num.pwpp),
                              as_grob(N2.G2.tub_num.pwpp),
                              row = 2,
                              ncol = 2,
                              labels = c("A", "B", "C", "D"))

ggsave("./emmeans_plots/grid_plots/emm_shoot_grid.pdf", grid_emm_shoot, width = 16, height = 16)
ggsave("./emmeans_plots/grid_plots/emm_root_grid.pdf", grid_emm_root, width = 16, height = 16)
ggsave("./emmeans_plots/grid_plots/emm_tuber_grid.pdf", grid_emm_tuber, width = 16, height = 16)
ggsave("./emmeans_plots/grid_plots/emm_tub_num_grid.pdf", grid_emm_tub_num, width = 16, height = 16)
```


## Bar Plots - MS2.Fig2

> n = 3

### High N
#### Shoot
##### Compute stats for plotting



```{r}
# G1
Fig2_N1_G1_shoot <- summarise(N1_shoot_noR1, N=length(wet.weight_mg), Average=mean(wet.weight_mg, na.rm = TRUE), CI95=conf_int95(wet.weight_mg), SE=std_error(wet.weight_mg)) %>% 
  filter(Genotype == "G1")

Fig2_N1_G1_shoot <- unite(Fig2_N1_G1_shoot, "Trt", c("Genotype", "N.level", "Inoculation"), sep = ".", remove = FALSE)

# G2
Fig2_N1_G2_shoot <- summarise(N1_shoot_noR1, N=length(wet.weight_mg), Average=mean(wet.weight_mg, na.rm = TRUE), CI95=conf_int95(wet.weight_mg), SE=std_error(wet.weight_mg)) %>% 
  filter(Genotype == "G2")

Fig2_N1_G2_shoot <- unite(Fig2_N1_G2_shoot, "Trt", c("Genotype", "N.level", "Inoculation"), sep = ".", remove = FALSE)

```

##### Bar Plot
```{r, fig.width = 10}
# ggplot with bars

Fig2_control_N1_G1_shoot <- Fig2_N1_G1_shoot[7,6] # set the control value for Genotype1 (RB)
Fig2_control_N1_G2_shoot <- Fig2_N1_G2_shoot[7,6] # set the control value for Genotype2 (RLS)

# calculate % control for each treatment

## Store control inouclation values for each genotype
Fig2_N1_G1_shoot$control <- as.numeric(Fig2_control_N1_G1_shoot)
Fig2_N1_G2_shoot$control <- as.numeric(Fig2_control_N1_G2_shoot)

## add a column with the control value for Genotype 1 to each record in the data frame.
Fig2_N1_G1_shoot <- mutate(Fig2_N1_G1_shoot, p_ctrl = (100* (Average / control)))

## add a column with the control value for GEnotype 2 to each record in the data frame.
Fig2_N1_G2_shoot <- mutate(Fig2_N1_G2_shoot, p_ctrl = (100* (Average / control)))

# G1 Shoot Plot
FW_N1_G1_shoot_bar <- ggplot(Fig2_N1_G1_shoot, aes(x = Trt, y = Average))
FW_N1_G1_shoot_bar <- FW_N1_G1_shoot_bar + geom_bar(stat = "identity", size=.5, fill="lightgreen")
FW_N1_G1_shoot_bar <- FW_N1_G1_shoot_bar + geom_hline(aes(yintercept=Fig2_N1_G1_shoot$control), colour="#990000", linetype="dashed")
FW_N1_G1_shoot_bar <- FW_N1_G1_shoot_bar + labs(x="", y="Shoot Weight (g)")
FW_N1_G1_shoot_bar <- FW_N1_G1_shoot_bar + geom_errorbar(aes(ymin=Average-SE, ymax=Average+SE), size=.5, width=.2)
FW_N1_G1_shoot_bar <- FW_N1_G1_shoot_bar + theme(
  #axis.text.x = element_text(angle = 60, hjust = 0, size = 12),
  axis.text.x = element_blank(),
  axis.ticks.x = element_blank(),
  axis.text.y = element_text(size = 12),
  axis.title.x = element_blank(),
  axis.title.y = element_text(size = 14),
  legend.text = element_text(size = 16),
  legend.title = element_text(size = 16))
FW_N1_G1_shoot_bar <- FW_N1_G1_shoot_bar + scale_x_discrete(position = "top", expand = c(0,0))
FW_N1_G1_shoot_bar <- FW_N1_G1_shoot_bar + scale_y_continuous(expand = c(0,0), limits = c(0,85))
FW_N1_G1_shoot_bar

# G2 Shoot Plot
FW_N1_G2_shoot_bar <- ggplot(Fig2_N1_G2_shoot, aes(x = Trt, y = Average))
FW_N1_G2_shoot_bar <- FW_N1_G2_shoot_bar + geom_bar(stat = "identity", size=.5, fill="lightgreen")
FW_N1_G2_shoot_bar <- FW_N1_G2_shoot_bar + geom_hline(aes(yintercept=Fig2_N1_G2_shoot$control), colour="purple2", linetype="dashed")
FW_N1_G2_shoot_bar <- FW_N1_G2_shoot_bar + labs(x="", y="Shoot Weight (g)")
FW_N1_G2_shoot_bar <- FW_N1_G2_shoot_bar + geom_errorbar(aes(ymin=Average-SE, ymax=Average+SE), size=.5, width=.2)
FW_N1_G2_shoot_bar <- FW_N1_G2_shoot_bar + theme(
  #axis.text.x = element_text(angle = 60, hjust = 0, size = 12),
  axis.text.x = element_blank(),
  axis.ticks.x = element_blank(),
  axis.text.y = element_text(size = 12),
  axis.title.x = element_blank(),
  axis.title.y = element_text(size = 14),
  legend.text = element_text(size = 16),
  legend.title = element_text(size = 16))
FW_N1_G2_shoot_bar <- FW_N1_G2_shoot_bar + scale_x_discrete(position = "top", expand = c(0,0))
FW_N1_G2_shoot_bar <- FW_N1_G2_shoot_bar + scale_y_continuous(expand = c(0,0), limits = c(0,57))
FW_N1_G2_shoot_bar
```

##### Side by side
```{r}
# bind G1 & G2
Fig2_N1_shoot <- bind_rows(Fig2_N1_G1_shoot, Fig2_N1_G2_shoot)

# X labels
Fig2.x.labels <- c("SynCom A", "SynCom B", "SynCom C", "SynCom D", "SynCom E", "SynCom F", "Control")

Fig2.A_shoot <- ggplot(Fig2_N1_shoot, aes(x = Inoculation, y = Average, fill= Genotype))
Fig2.A_shoot <- Fig2.A_shoot + geom_bar(stat = "identity", size=.3,
                                        position = position_dodge(.9))
Fig2.A_shoot <- Fig2.A_shoot + geom_errorbar(aes(ymin=Average-SE, ymax=Average+SE),
                                             size=.4,
                                             width=.4,
                                             position = position_dodge(.9))

Fig2.A_shoot <- Fig2.A_shoot + labs(y = "Shoot Weight (g)")

Fig2.A_shoot <- Fig2.A_shoot + scale_fill_manual(labels = c("Russet Burbank", "Red La Soda"),
                                                 values = c("tan2", "indianred3"))
Fig2.A_shoot <- Fig2.A_shoot + scale_x_discrete(labels = Fig2.x.labels)
Fig2.A_shoot <- Fig2.A_shoot + scale_y_continuous(expand = c(0,0), limits = c(0, 88))

Fig2.A_shoot <- Fig2.A_shoot + theme(
  axis.text.x = element_text(angle = 25, size = 12, hjust = 1),
  axis.text.y = element_text(size = 12),
  axis.title.x = element_blank(),
  axis.title.y = element_text(size = 14),
  legend.text = element_text(size = 16),
  legend.title = element_text(size = 16),
  legend.position = "bottom")

Fig2.A_shoot

```


#### Root
##### Compute stats for plotting

> n=3

```{r}
# G1
Fig2_N1_G1_root <- summarise(N1_root_noR1, N=length(wet.weight_mg), Average=mean(wet.weight_mg, na.rm = TRUE), CI95=conf_int95(wet.weight_mg), SE=std_error(wet.weight_mg)) %>% 
  filter(Genotype == "G1")

Fig2_N1_G1_root <- unite(Fig2_N1_G1_root, "Trt", c("Genotype", "N.level", "Inoculation"), sep = ".", remove = FALSE)

# G2
Fig2_N1_G2_root <- summarise(N1_root_noR1, N=length(wet.weight_mg), Average=mean(wet.weight_mg, na.rm = TRUE), CI95=conf_int95(wet.weight_mg), SE=std_error(wet.weight_mg)) %>% 
  filter(Genotype == "G2")

Fig2_N1_G2_root <- unite(Fig2_N1_G2_root, "Trt", c("Genotype", "N.level", "Inoculation"), sep = ".", remove = FALSE)

```

##### Bar Plot
```{r, fig.width = 10}
# ggplot with bars

control_N1_G1_root <- Fig2_N1_G1_root[7,6] # set the control value for Genotype1 (RB)
control_N1_G2_root <- Fig2_N1_G2_root[7,6] # set the control value for Genotype2 (RLS)

# calculate % control for each treatment

## Store control inouclation values for each genotype
Fig2_N1_G1_root$control <- as.numeric(control_N1_G1_root)
Fig2_N1_G2_root$control <- as.numeric(control_N1_G2_root)

## add a column with the control value for Genotype 1 to each record in the data frame.
Fig2_N1_G1_root <- mutate(Fig2_N1_G1_root, p_ctrl_G1 = (100* (Average / control)))

## add a column with the control value for GEnotype 2 to each record in the data frame.
Fig2_N1_G2_root <- mutate(Fig2_N1_G2_root, p_ctrl_G1 = (100* (Average / control)))

# G1 root Plot
FW_N1_G1_root_bar <- ggplot(Fig2_N1_G1_root, aes(x = Trt, y = Average))
FW_N1_G1_root_bar <- FW_N1_G1_root_bar + geom_bar(stat = "identity", size=.5, fill="tan3")
FW_N1_G1_root_bar <- FW_N1_G1_root_bar + geom_hline(aes(yintercept=Fig2_N1_G1_root$control), colour="#990000", linetype="dashed")
FW_N1_G1_root_bar <- FW_N1_G1_root_bar + labs(x="", y="Root Weight (g)")
FW_N1_G1_root_bar <- FW_N1_G1_root_bar + geom_errorbar(aes(ymin=Average-SE, ymax=Average+SE), size=.5, width=.2)
FW_N1_G1_root_bar <- FW_N1_G1_root_bar + theme(
  #axis.text.x = element_text(angle = 60, hjust = 0, size = 12),
  axis.text.x = element_blank(),
  axis.ticks.x = element_blank(),
  axis.text.y = element_text(size = 12),
  axis.title.x = element_blank(),
  axis.title.y = element_text(size = 14),
  legend.text = element_text(size = 16),
  legend.title = element_text(size = 16))
FW_N1_G1_root_bar <- FW_N1_G1_root_bar + scale_x_discrete(position = "top", expand = c(0,0))
FW_N1_G1_root_bar <- FW_N1_G1_root_bar + scale_y_continuous(expand = c(0,0), limits = c(0,55))
FW_N1_G1_root_bar

# G2 root Plot
FW_N1_G2_root_bar <- ggplot(Fig2_N1_G2_root, aes(x = Trt, y = Average))
FW_N1_G2_root_bar <- FW_N1_G2_root_bar + geom_bar(stat = "identity", size=.5, fill="tan3")
FW_N1_G2_root_bar <- FW_N1_G2_root_bar + geom_hline(aes(yintercept=Fig2_N1_G2_root$control), colour="purple2", linetype="dashed")
FW_N1_G2_root_bar <- FW_N1_G2_root_bar + labs(x="", y="Root Weight (g)")
FW_N1_G2_root_bar <- FW_N1_G2_root_bar + geom_errorbar(aes(ymin=Average-SE, ymax=Average+SE), size=.5, width=.2)
FW_N1_G2_root_bar <- FW_N1_G2_root_bar + theme(
  #axis.text.x = element_text(angle = 60, hjust = 0, size = 12),
  axis.text.x = element_blank(),
  axis.ticks.x = element_blank(),
  axis.text.y = element_text(size = 12),
  axis.title.x = element_blank(),
  axis.title.y = element_text(size = 14),
  legend.text = element_text(size = 16),
  legend.title = element_text(size = 16))
FW_N1_G2_root_bar <- FW_N1_G2_root_bar + scale_x_discrete(position = "top", expand = c(0,0))
FW_N1_G2_root_bar <- FW_N1_G2_root_bar + scale_y_continuous(expand = c(0,0), limits = c(0,35))
FW_N1_G2_root_bar
```

##### Side by side
```{r}
# bind G1 & G2
Fig2_N1_root <- bind_rows(Fig2_N1_G1_root, Fig2_N1_G2_root)

# X labels
Fig2.x.labels <- c("SynCom A", "SynCom B", "SynCom C", "SynCom D", "SynCom E", "SynCom F", "Control")

Fig2.A_root <- ggplot(Fig2_N1_root, aes(x = Inoculation, y = Average, fill= Genotype))
Fig2.A_root <- Fig2.A_root + geom_bar(stat = "identity", size=.3,
                                        position = position_dodge(.9))
Fig2.A_root <- Fig2.A_root + geom_errorbar(aes(ymin=Average-SE, ymax=Average+SE),
                                             size=.4,
                                             width=.4,
                                             position = position_dodge(.9))

Fig2.A_root <- Fig2.A_root + labs(y = "Root Weight (g)")

Fig2.A_root <- Fig2.A_root + scale_fill_manual(labels = c("Russet Burbank", "Red La Soda"),
                                                 values = c("tan2", "indianred3"))
Fig2.A_root <- Fig2.A_root + scale_x_discrete(labels = Fig2.x.labels)
Fig2.A_root <- Fig2.A_root + scale_y_continuous(expand = c(0,0), limits = c(0, 55))

Fig2.A_root <- Fig2.A_root + theme(
  axis.text.x = element_text(angle = 25, size = 12, hjust = 1),
  axis.text.y = element_text(size = 12),
  axis.title.x = element_blank(),
  axis.title.y = element_text(size = 14),
  legend.text = element_text(size = 16),
  legend.title = element_text(size = 16),
  legend.position = "bottom")

Fig2.A_root

```

#### Tuber
##### Compute stats for plotting

```{r}
# G1
Fig2_N1_G1_tuber <- summarise(N1_tuber_noR1, N=length(wet.weight_mg), Average=mean(wet.weight_mg, na.rm = TRUE), CI95=conf_int95(wet.weight_mg), SE=std_error(wet.weight_mg)) %>% 
  filter(Genotype == "G1")

Fig2_N1_G1_tuber <- unite(Fig2_N1_G1_tuber, "Trt", c("Genotype", "N.level", "Inoculation"), sep = ".", remove = FALSE)

# G2
Fig2_N1_G2_tuber <- summarise(N1_tuber_noR1, N=length(wet.weight_mg), Average=mean(wet.weight_mg, na.rm = TRUE), CI95=conf_int95(wet.weight_mg), SE=std_error(wet.weight_mg)) %>% 
  filter(Genotype == "G2")

Fig2_N1_G2_tuber <- unite(Fig2_N1_G2_tuber, "Trt", c("Genotype", "N.level", "Inoculation"), sep = ".", remove = FALSE)

```

##### Bar Plot
```{r, fig.width = 10}
# ggplot with bars

control_N1_G1_tuber <- Fig2_N1_G1_tuber[7,6] # set the control value for Genotype1 (RB)
control_N1_G2_tuber <- Fig2_N1_G2_tuber[7,6] # set the control value for Genotype2 (RLS)

# calculate % control for each treatment

## Store control inouclation values for each genotype
Fig2_N1_G1_tuber$control <- as.numeric(control_N1_G1_tuber)
Fig2_N1_G2_tuber$control <- as.numeric(control_N1_G2_tuber)

## add a column with the control value for Genotype 1 to each record in the data frame.
Fig2_N1_G1_tuber <- mutate(Fig2_N1_G1_tuber, p_ctrl_G1 = (100* (Average / control)))

## add a column with the control value for GEnotype 2 to each record in the data frame.
Fig2_N1_G2_tuber <- mutate(Fig2_N1_G2_tuber, p_ctrl_G1 = (100* (Average / control)))

# G1 tuber Plot
FW_N1_G1_tuber_bar <- ggplot(Fig2_N1_G1_tuber, aes(x = Inoculation, y = Average))
FW_N1_G1_tuber_bar <- FW_N1_G1_tuber_bar + geom_bar(stat = "identity", size=.5, fill="lightsalmon")
FW_N1_G1_tuber_bar <- FW_N1_G1_tuber_bar + geom_hline(aes(yintercept=Fig2_N1_G1_tuber$control), colour="#990000", linetype="dashed")
FW_N1_G1_tuber_bar <- FW_N1_G1_tuber_bar + labs(x="", y="Tuber Weight (g)")
FW_N1_G1_tuber_bar <- FW_N1_G1_tuber_bar + geom_errorbar(aes(ymin=Average-SE, ymax=Average+SE), size=.5, width=.2)
FW_N1_G1_tuber_bar <- FW_N1_G1_tuber_bar + theme(
  axis.text.x = element_text(angle = 0, hjust = 1, size = 12),
  axis.ticks.x = element_blank(),
  axis.text.y = element_text(size = 12),
  axis.title.x = element_blank(),
  axis.title.y = element_text(size = 14),
  legend.text = element_text(size = 16),
  legend.title = element_text(size = 16))
FW_N1_G1_tuber_bar <- FW_N1_G1_tuber_bar + scale_x_discrete(position = "bottom", expand = c(0,0))
FW_N1_G1_tuber_bar <- FW_N1_G1_tuber_bar + scale_y_continuous(expand = c(0,0), limits = c(0,240))
FW_N1_G1_tuber_bar

# G2 tuber Plot
FW_N1_G2_tuber_bar <- ggplot(Fig2_N1_G2_tuber, aes(x = Inoculation, y = Average))
FW_N1_G2_tuber_bar <- FW_N1_G2_tuber_bar + geom_bar(stat = "identity", size=.5, fill="lightsalmon")
FW_N1_G2_tuber_bar <- FW_N1_G2_tuber_bar + geom_hline(aes(yintercept=Fig2_N1_G2_tuber$control), colour="purple2", linetype="dashed")
FW_N1_G2_tuber_bar <- FW_N1_G2_tuber_bar + labs(x="", y="Tuber Weight (g)")
FW_N1_G2_tuber_bar <- FW_N1_G2_tuber_bar + geom_errorbar(aes(ymin=Average-SE, ymax=Average+SE), size=.5, width=.2)
FW_N1_G2_tuber_bar <- FW_N1_G2_tuber_bar + theme(
  axis.text.x = element_text(angle = 0, hjust = 1, size = 12),
  axis.ticks.x = element_blank(),
  axis.text.y = element_text(size = 12),
  axis.title.x = element_blank(),
  axis.title.y = element_text(size = 14),
  legend.text = element_text(size = 16),
  legend.title = element_text(size = 16))
FW_N1_G2_tuber_bar <- FW_N1_G2_tuber_bar + scale_x_discrete(position = "bottom", expand = c(0,0))
FW_N1_G2_tuber_bar <- FW_N1_G2_tuber_bar + scale_y_continuous(expand = c(0,0), limits = c(0,240))
FW_N1_G2_tuber_bar
```

##### Side by side
```{r}
# bind G1 & G2
Fig2_N1_tuber <- bind_rows(Fig2_N1_G1_tuber, Fig2_N1_G2_tuber)

# X labels
Fig2.x.labels <- c("SynCom A", "SynCom B", "SynCom C", "SynCom D", "SynCom E", "SynCom F", "Control")

Fig2.A_tuber <- ggplot(Fig2_N1_tuber, aes(x = Inoculation, y = Average, fill= Genotype))
Fig2.A_tuber <- Fig2.A_tuber + geom_bar(stat = "identity", size=.3,
                                        position = position_dodge(.9))
Fig2.A_tuber <- Fig2.A_tuber + geom_errorbar(aes(ymin=Average-SE, ymax=Average+SE),
                                             size=.4,
                                             width=.4,
                                             position = position_dodge(.9))

Fig2.A_tuber <- Fig2.A_tuber + labs(y = "Tuber Weight (g)")

Fig2.A_tuber <- Fig2.A_tuber + scale_fill_manual(labels = c("Russet Burbank", "Red La Soda"),
                                                 values = c("tan2", "indianred3"))
Fig2.A_tuber <- Fig2.A_tuber + scale_x_discrete(labels = Fig2.x.labels)
Fig2.A_tuber <- Fig2.A_tuber + scale_y_continuous(expand = c(0,0), limits = c(0, 245))

Fig2.A_tuber <- Fig2.A_tuber + theme(
  axis.text.x = element_text(angle = 25, size = 12, hjust = 1),
  axis.text.y = element_text(size = 12),
  axis.title.x = element_blank(),
  axis.title.y = element_text(size = 14),
  legend.text = element_text(size = 16),
  legend.title = element_text(size = 16),
  legend.position = "bottom")

Fig2.A_tuber

```

#### Cowplot 1

```{r, fig.width=10}
# 3 stack for G1, N1
FW_N1_G1_barstack <- plot_grid(FW_N1_G1_shoot_bar, FW_N1_G1_root_bar, FW_N1_G1_tuber_bar, nrow = 3, align = "v", labels = "Russet Burbank, 100% Nitrogen")

# 3 stack for G2, N1
FW_N1_G2_barstack <- plot_grid(FW_N1_G2_shoot_bar + theme(axis.title.y = element_blank()),
                               FW_N1_G2_root_bar + theme(axis.title.y = element_blank()),
                               FW_N1_G2_tuber_bar + theme(axis.title.y = element_blank()),
                               nrow = 3, align = "v", labels = "Red La Soda, 100% Nitrogen")

# G1 and G2, High N
FW_N1_G1_and_G2 <- plot_grid(FW_N1_G1_barstack, FW_N1_G2_barstack, nrow = 1)
FW_N1_G1_and_G2

```

#### Cowplot side by side
```{r}
Fig2.N1.grid <- plot_grid(Fig2.A_shoot + theme(legend.position = "none"),
                          Fig2.A_root + theme(legend.position = "none"),
                          Fig2.A_tuber + theme(legend.position = "none"),
                          ncol = 3,
                          labels = c("A", "B", "C"),
                          label_size = 18)
Fig2.N1.grid
```


### Low N
#### Shoot
##### Compute stats for plotting

```{r}
# G1
stat_N2_G1_shoot_noR1 <- summarise(N2_shoot_noR1, N=length(wet.weight_mg), Average=mean(wet.weight_mg, na.rm = TRUE), CI95=conf_int95(wet.weight_mg), SE=std_error(wet.weight_mg)) %>% 
  filter(Genotype == "G1")

stat_N2_G1_shoot_noR1 <- unite(stat_N2_G1_shoot_noR1, "Trt", c("Genotype", "N.level", "Inoculation"), sep = ".", remove = FALSE)

# G2
stat_N2_G2_shoot_noR1 <- summarise(N2_shoot_noR1, N=length(wet.weight_mg), Average=mean(wet.weight_mg, na.rm = TRUE), CI95=conf_int95(wet.weight_mg), SE=std_error(wet.weight_mg)) %>% 
  filter(Genotype == "G2")

stat_N2_G2_shoot_noR1 <- unite(stat_N2_G2_shoot_noR1, "Trt", c("Genotype", "N.level", "Inoculation"), sep = ".", remove = FALSE)

```

##### Bar Plot
```{r, fig.width = 10}
# ggplot with bars

control_N2_G1_shoot_noR1 <- stat_N2_G1_shoot_noR1[7,6] # set the control value for Genotype1 (RB)
control_N2_G2_shoot_noR1 <- stat_N2_G2_shoot_noR1[7,6] # set the control value for Genotype2 (RLS)

# calculate % control for each treatment

## Store control inouclation values for each genotype
stat_N2_G1_shoot_noR1$control <- as.numeric(control_N2_G1_shoot_noR1)
stat_N2_G2_shoot_noR1$control <- as.numeric(control_N2_G2_shoot_noR1)

## add a column with the control value for Genotype 1 to each record in the data frame.
stat_N2_G1_shoot_noR1 <- mutate(stat_N2_G1_shoot_noR1, p_ctrl_G1 = (100* (Average / control)))

## add a column with the control value for GEnotype 2 to each record in the data frame.
stat_N2_G2_shoot_noR1 <- mutate(stat_N2_G2_shoot_noR1, p_ctrl_G1 = (100* (Average / control)))

# G1 Shoot Plot
FW_N2_G1_shoot_bar_noR1 <- ggplot(stat_N2_G1_shoot_noR1, aes(x = Trt, y = Average))
FW_N2_G1_shoot_bar_noR1 <- FW_N2_G1_shoot_bar_noR1 + geom_bar(stat = "identity", size=.5, fill="lightgreen")
FW_N2_G1_shoot_bar_noR1 <- FW_N2_G1_shoot_bar_noR1 + geom_hline(aes(yintercept=stat_N2_G1_shoot_noR1$control), colour="#990000", linetype="dashed")
FW_N2_G1_shoot_bar_noR1 <- FW_N2_G1_shoot_bar_noR1 + labs(x="", y="Shoot Weight (g)")
FW_N2_G1_shoot_bar_noR1 <- FW_N2_G1_shoot_bar_noR1 + geom_errorbar(aes(ymin=Average-SE, ymax=Average+SE), size=.5, width=.2)
FW_N2_G1_shoot_bar_noR1 <- FW_N2_G1_shoot_bar_noR1 + theme(
  #axis.text.x = element_text(angle = 60, hjust = 0, size = 12),
  axis.text.x = element_blank(),
  axis.ticks.x = element_blank(),
  axis.text.y = element_text(size = 12),
  axis.title.x = element_blank(),
  axis.title.y = element_text(size = 14),
  legend.text = element_text(size = 16),
  legend.title = element_text(size = 16))
FW_N2_G1_shoot_bar_noR1 <- FW_N2_G1_shoot_bar_noR1 + scale_x_discrete(position = "top", expand = c(0,0))
FW_N2_G1_shoot_bar_noR1 <- FW_N2_G1_shoot_bar_noR1 + scale_y_continuous(expand = c(0,0), limits = c(0,75))
FW_N2_G1_shoot_bar_noR1

# G2 Shoot Plot
FW_N2_G2_shoot_bar_noR1 <- ggplot(stat_N2_G2_shoot_noR1, aes(x = Trt, y = Average))
FW_N2_G2_shoot_bar_noR1 <- FW_N2_G2_shoot_bar_noR1 + geom_bar(stat = "identity", size=.5, fill="lightgreen")
FW_N2_G2_shoot_bar_noR1 <- FW_N2_G2_shoot_bar_noR1 + geom_hline(aes(yintercept=stat_N2_G2_shoot_noR1$control), colour="purple2", linetype="dashed")
FW_N2_G2_shoot_bar_noR1 <- FW_N2_G2_shoot_bar_noR1 + labs(x="", y="Shoot Weight (g)")
FW_N2_G2_shoot_bar_noR1 <- FW_N2_G2_shoot_bar_noR1 + geom_errorbar(aes(ymin=Average-SE, ymax=Average+SE), size=.5, width=.2)
FW_N2_G2_shoot_bar_noR1 <- FW_N2_G2_shoot_bar_noR1 + theme(
  #axis.text.x = element_text(angle = 60, hjust = 0, size = 12),
  axis.text.x = element_blank(),
  axis.ticks.x = element_blank(),
  axis.text.y = element_text(size = 12),
  axis.title.x = element_blank(),
  axis.title.y = element_text(size = 14),
  legend.text = element_text(size = 16),
  legend.title = element_text(size = 16))
FW_N2_G2_shoot_bar_noR1 <- FW_N2_G2_shoot_bar_noR1 + scale_x_discrete(position = "top", expand = c(0,0))
FW_N2_G2_shoot_bar_noR1 <- FW_N2_G2_shoot_bar_noR1 + scale_y_continuous(expand = c(0,0), limits = c(0,57))
FW_N2_G2_shoot_bar_noR1
```

##### Side by side
```{r}
# bind G1 & G2
Fig2_N2_shoot <- bind_rows(stat_N2_G1_shoot_noR1, stat_N2_G2_shoot_noR1)

# X labels
Fig2.x.labels <- c("SynCom A", "SynCom B", "SynCom C", "SynCom D", "SynCom E", "SynCom F", "Control")

Fig2.B_shoot <- ggplot(Fig2_N2_shoot, aes(x = Inoculation, y = Average, fill= Genotype))
Fig2.B_shoot <- Fig2.B_shoot + geom_bar(stat = "identity", size=.3,
                                        position = position_dodge(.9))
Fig2.B_shoot <- Fig2.B_shoot + geom_errorbar(aes(ymin=Average-SE, ymax=Average+SE),
                                             size=.4,
                                             width=.4,
                                             position = position_dodge(.9))

Fig2.B_shoot <- Fig2.B_shoot + labs(y = "Shoot Weight (g)")

Fig2.B_shoot <- Fig2.B_shoot + scale_fill_manual(labels = c("Russet Burbank", "Red La Soda"),
                                                 values = c("tan2", "indianred3"))
Fig2.B_shoot <- Fig2.B_shoot + scale_x_discrete(labels = Fig2.x.labels)
Fig2.B_shoot <- Fig2.B_shoot + scale_y_continuous(expand = c(0,0), limits = c(0, 79))

Fig2.B_shoot <- Fig2.B_shoot + theme(
  axis.text.x = element_text(angle = 25, size = 12, hjust = 1),
  axis.text.y = element_text(size = 12),
  axis.title.x = element_blank(),
  axis.title.y = element_text(size = 14),
  legend.text = element_text(size = 16),
  legend.title = element_text(size = 16),
  legend.position = "bottom")

Fig2.B_shoot

```

#### Root
##### Compute stats for plotting

```{r}
# G1
stat_N2_G1_root_noR1 <- summarise(N2_root_noR1, N=length(wet.weight_mg), Average=mean(wet.weight_mg, na.rm = TRUE), CI95=conf_int95(wet.weight_mg), SE=std_error(wet.weight_mg)) %>% 
  filter(Genotype == "G1")
stat_N2_G1_root_noR1 <- unite(stat_N2_G1_root_noR1, "Trt", c("Genotype", "N.level", "Inoculation"), sep = ".", remove = FALSE)

# G2
stat_N2_G2_root_noR1 <- summarise(N2_root_noR1, N=length(wet.weight_mg), Average=mean(wet.weight_mg, na.rm = TRUE), CI95=conf_int95(wet.weight_mg), SE=std_error(wet.weight_mg)) %>% 
  filter(Genotype == "G2")

stat_N2_G2_root_noR1 <- unite(stat_N2_G2_root_noR1, "Trt", c("Genotype", "N.level", "Inoculation"), sep = ".", remove = FALSE)

```

##### Bar Plot
```{r, fig.width = 10}
# ggplot with bars

control_N2_G1_root_noR1 <- stat_N2_G1_root_noR1[7,6] # set the control value for Genotype1 (RB)
control_N2_G2_root_noR1 <- stat_N2_G2_root_noR1[7,6] # set the control value for Genotype2 (RLS)

# calculate % control for each treatment

## Store control inouclation values for each genotype
stat_N2_G1_root_noR1$control <- as.numeric(control_N2_G1_root_noR1)
stat_N2_G2_root_noR1$control <- as.numeric(control_N2_G2_root_noR1)

## add a column with the control value for Genotype 1 to each record in the data frame.
stat_N2_G1_root_noR1 <- mutate(stat_N2_G1_root_noR1, p_ctrl_G1 = (100* (Average / control)))

## add a column with the control value for GEnotype 2 to each record in the data frame.
stat_N2_G2_root_noR1 <- mutate(stat_N2_G2_root_noR1, p_ctrl_G1 = (100* (Average / control)))

# G1 root Plot
FW_N2_G1_root_bar_noR1 <- ggplot(stat_N2_G1_root_noR1, aes(x = Trt, y = Average))
FW_N2_G1_root_bar_noR1 <- FW_N2_G1_root_bar_noR1 + geom_bar(stat = "identity", size=.5, fill="tan3")
FW_N2_G1_root_bar_noR1 <- FW_N2_G1_root_bar_noR1 + geom_hline(aes(yintercept=stat_N2_G1_root_noR1$control), colour="#990000", linetype="dashed")
FW_N2_G1_root_bar_noR1 <- FW_N2_G1_root_bar_noR1 + labs(x="", y="Root Weight (g)")
FW_N2_G1_root_bar_noR1 <- FW_N2_G1_root_bar_noR1 + geom_errorbar(aes(ymin=Average-SE, ymax=Average+SE), size=.5, width=.2)
FW_N2_G1_root_bar_noR1 <- FW_N2_G1_root_bar_noR1 + theme(
  #axis.text.x = element_text(angle = 60, hjust = 0, size = 12),
  axis.text.x = element_blank(),
  axis.ticks.x = element_blank(),
  axis.text.y = element_text(size = 12),
  axis.title.x = element_blank(),
  axis.title.y = element_text(size = 14),
  legend.text = element_text(size = 16),
  legend.title = element_text(size = 16))
FW_N2_G1_root_bar_noR1 <- FW_N2_G1_root_bar_noR1 + scale_x_discrete(position = "top", expand = c(0,0))
FW_N2_G1_root_bar_noR1 <- FW_N2_G1_root_bar_noR1 + scale_y_continuous(expand = c(0,0), limits = c(0,47))
FW_N2_G1_root_bar_noR1

# G2 root Plot
FW_N2_G2_root_bar_noR1 <- ggplot(stat_N2_G2_root_noR1, aes(x = Trt, y = Average))
FW_N2_G2_root_bar_noR1 <- FW_N2_G2_root_bar_noR1 + geom_bar(stat = "identity", size=.5, fill="tan3")
FW_N2_G2_root_bar_noR1 <- FW_N2_G2_root_bar_noR1 + geom_hline(aes(yintercept=stat_N2_G2_root_noR1$control), colour="purple2", linetype="dashed")
FW_N2_G2_root_bar_noR1 <- FW_N2_G2_root_bar_noR1 + labs(x="", y="Root Weight (g)")
FW_N2_G2_root_bar_noR1 <- FW_N2_G2_root_bar_noR1 + geom_errorbar(aes(ymin=Average-SE, ymax=Average+SE), size=.5, width=.2)
FW_N2_G2_root_bar_noR1 <- FW_N2_G2_root_bar_noR1 + theme(
  #axis.text.x = element_text(angle = 60, hjust = 0, size = 12),
  axis.text.x = element_blank(),
  axis.ticks.x = element_blank(),
  axis.text.y = element_text(size = 12),
  axis.title.x = element_blank(),
  axis.title.y = element_text(size = 14),
  legend.text = element_text(size = 16),
  legend.title = element_text(size = 16))
FW_N2_G2_root_bar_noR1 <- FW_N2_G2_root_bar_noR1 + scale_x_discrete(position = "top", expand = c(0,0))
FW_N2_G2_root_bar_noR1 <- FW_N2_G2_root_bar_noR1 + scale_y_continuous(expand = c(0,0), limits = c(0,28))
FW_N2_G2_root_bar_noR1
```

##### Side by side
```{r}
# bind G1 & G2
Fig2_N2_root <- bind_rows(stat_N2_G1_root_noR1, stat_N2_G2_root_noR1)

# X labels
Fig2.x.labels <- c("SynCom A", "SynCom B", "SynCom C", "SynCom D", "SynCom E", "SynCom F", "Control")

Fig2.B_root <- ggplot(Fig2_N2_root, aes(x = Inoculation, y = Average, fill= Genotype))
Fig2.B_root <- Fig2.B_root + geom_bar(stat = "identity", size=.3,
                                        position = position_dodge(.9))
Fig2.B_root <- Fig2.B_root + geom_errorbar(aes(ymin=Average-SE, ymax=Average+SE),
                                             size=.4,
                                             width=.4,
                                             position = position_dodge(.9))

Fig2.B_root <- Fig2.B_root + labs(y = "Root Weight (g)")

Fig2.B_root <- Fig2.B_root + scale_fill_manual(labels = c("Russet Burbank", "Red La Soda"),
                                                 values = c("tan2", "indianred3"))
Fig2.B_root <- Fig2.B_root + scale_x_discrete(labels = Fig2.x.labels)
Fig2.B_root <- Fig2.B_root + scale_y_continuous(expand = c(0,0), limits = c(0, 49))

Fig2.B_root <- Fig2.B_root + theme(
  axis.text.x = element_text(angle = 25, size = 12, hjust = 1),
  axis.text.y = element_text(size = 12),
  axis.title.x = element_blank(),
  axis.title.y = element_text(size = 14),
  legend.text = element_text(size = 16),
  legend.title = element_text(size = 16),
  legend.position = "bottom")

Fig2.B_root

```

#### Tuber
##### Compute stats for plotting

```{r}
# G1
stat_N2_G1_tuber_noR1 <- summarise(N2_tuber_noR1, N=length(wet.weight_mg), Average=mean(wet.weight_mg, na.rm = TRUE), CI95=conf_int95(wet.weight_mg), SE=std_error(wet.weight_mg)) %>% 
  filter(Genotype == "G1")

stat_N2_G1_tuber_noR1 <- unite(stat_N2_G1_tuber_noR1, "Trt", c("Genotype", "N.level", "Inoculation"), sep = ".", remove = FALSE)

# G2
stat_N2_G2_tuber_noR1 <- summarise(N2_tuber_noR1, N=length(wet.weight_mg), Average=mean(wet.weight_mg, na.rm = TRUE), CI95=conf_int95(wet.weight_mg), SE=std_error(wet.weight_mg)) %>% 
  filter(Genotype == "G2")

stat_N2_G2_tuber_noR1 <- unite(stat_N2_G2_tuber_noR1, "Trt", c("Genotype", "N.level", "Inoculation"), sep = ".", remove = FALSE)

```

##### Bar Plot
```{r, fig.width = 10}
# ggplot with bars

control_N2_G1_tuber_noR1 <- stat_N2_G1_tuber_noR1[7,6] # set the control value for Genotype1 (RB)
control_N2_G2_tuber_noR1 <- stat_N2_G2_tuber_noR1[7,6] # set the control value for Genotype2 (RLS)

# calculate % control for each treatment

## Store control inouclation values for each genotype
stat_N2_G1_tuber_noR1$control <- as.numeric(control_N2_G1_tuber_noR1)
stat_N2_G2_tuber_noR1$control <- as.numeric(control_N2_G2_tuber_noR1)

## add a column with the control value for Genotype 1 to each record in the data frame.
stat_N2_G1_tuber_noR1 <- mutate(stat_N2_G1_tuber_noR1, p_ctrl_G1 = (100* (Average / control)))

## add a column with the control value for GEnotype 2 to each record in the data frame.
stat_N2_G2_tuber_noR1 <- mutate(stat_N2_G2_tuber_noR1, p_ctrl_G1 = (100* (Average / control)))

# G1 tuber Plot
FW_N2_G1_tuber_bar_noR1 <- ggplot(stat_N2_G1_tuber_noR1, aes(x = Inoculation, y = Average))
FW_N2_G1_tuber_bar_noR1 <- FW_N2_G1_tuber_bar_noR1 + geom_bar(stat = "identity", size=.5, fill="lightsalmon")
FW_N2_G1_tuber_bar_noR1 <- FW_N2_G1_tuber_bar_noR1 + geom_hline(aes(yintercept=stat_N2_G1_tuber_noR1$control), colour="#990000", linetype="dashed")
FW_N2_G1_tuber_bar_noR1 <- FW_N2_G1_tuber_bar_noR1 + labs(x="", y="Tuber Weight (g)")
FW_N2_G1_tuber_bar_noR1 <- FW_N2_G1_tuber_bar_noR1 + geom_errorbar(aes(ymin=Average-SE, ymax=Average+SE), size=.5, width=.2)
FW_N2_G1_tuber_bar_noR1 <- FW_N2_G1_tuber_bar_noR1 + theme(
  axis.text.x = element_text(angle = 0, hjust = 1, size = 12),
  axis.ticks.x = element_blank(),
  axis.text.y = element_text(size = 12),
  axis.title.x = element_blank(),
  axis.title.y = element_text(size = 14),
  legend.text = element_text(size = 16),
  legend.title = element_text(size = 16))
FW_N2_G1_tuber_bar_noR1 <- FW_N2_G1_tuber_bar_noR1 + scale_x_discrete(position = "bottom", expand = c(0,0))
FW_N2_G1_tuber_bar_noR1 <- FW_N2_G1_tuber_bar_noR1 + scale_y_continuous(expand = c(0,0), limits = c(0,170))
FW_N2_G1_tuber_bar_noR1

# G2 tuber Plot
FW_N2_G2_tuber_bar_noR1 <- ggplot(stat_N2_G2_tuber_noR1, aes(x = Inoculation, y = Average))
FW_N2_G2_tuber_bar_noR1 <- FW_N2_G2_tuber_bar_noR1 + geom_bar(stat = "identity", size=.5, fill="lightsalmon")
FW_N2_G2_tuber_bar_noR1 <- FW_N2_G2_tuber_bar_noR1 + geom_hline(aes(yintercept=stat_N2_G2_tuber_noR1$control), colour="purple2", linetype="dashed")
FW_N2_G2_tuber_bar_noR1 <- FW_N2_G2_tuber_bar_noR1 + labs(x="", y="Tuber Weight (g)")
FW_N2_G2_tuber_bar_noR1 <- FW_N2_G2_tuber_bar_noR1 + geom_errorbar(aes(ymin=Average-SE, ymax=Average+SE), size=.5, width=.2)
FW_N2_G2_tuber_bar_noR1 <- FW_N2_G2_tuber_bar_noR1 + theme(
  axis.text.x = element_text(angle = 0, hjust = 1, size = 12),
  axis.ticks.x = element_blank(),
  axis.text.y = element_text(size = 12),
  axis.title.x = element_blank(),
  axis.title.y = element_text(size = 14),
  legend.text = element_text(size = 16),
  legend.title = element_text(size = 16))
FW_N2_G2_tuber_bar_noR1 <- FW_N2_G2_tuber_bar_noR1 + scale_x_discrete(position = "bottom", expand = c(0,0))
FW_N2_G2_tuber_bar_noR1 <- FW_N2_G2_tuber_bar_noR1 + scale_y_continuous(expand = c(0,0), limits = c(0,170))
FW_N2_G2_tuber_bar_noR1
```

##### Side by side
```{r}
# bind G1 & G2
Fig2_N2_tuber <- bind_rows(stat_N2_G1_tuber_noR1, stat_N2_G2_tuber_noR1)

# X labels
Fig2.x.labels <- c("SynCom A", "SynCom B", "SynCom C", "SynCom D", "SynCom E", "SynCom F", "Control")

Fig2.B_tuber <- ggplot(Fig2_N2_tuber, aes(x = Inoculation, y = Average, fill= Genotype))
Fig2.B_tuber <- Fig2.B_tuber + geom_bar(stat = "identity", size=.3,
                                        position = position_dodge(.9))
Fig2.B_tuber <- Fig2.B_tuber + geom_errorbar(aes(ymin=Average-SE, ymax=Average+SE),
                                             size=.4,
                                             width=.4,
                                             position = position_dodge(.9))

Fig2.B_tuber <- Fig2.B_tuber + labs(y = "Tuber Weight (g)")

Fig2.B_tuber <- Fig2.B_tuber + scale_fill_manual(labels = c("Russet Burbank", "Red La Soda"),
                                                 values = c("tan2", "indianred3"))
Fig2.B_tuber <- Fig2.B_tuber + scale_x_discrete(labels = Fig2.x.labels)
Fig2.B_tuber <- Fig2.B_tuber + scale_y_continuous(expand = c(0,0), limits = c(0, 185))


Fig2.B_tuber <- Fig2.B_tuber + theme(
  axis.text.x = element_text(angle = 25, size = 12, hjust = 1),
  axis.text.y = element_text(size = 12),
  axis.title.x = element_blank(),
  axis.title.y = element_text(size = 14),
  legend.text = element_text(size = 16),
  legend.title = element_text(size = 16),
  legend.position = "bottom")

Fig2.B_tuber

```


#### Cowplot 1

```{r, fig.width=10}
# 3 stack for G1, N2
FW_N2_G1_barstack_noR1 <- plot_grid(FW_N2_G1_shoot_bar_noR1, FW_N2_G1_root_bar_noR1, FW_N2_G1_tuber_bar_noR1, nrow = 3, align = "v", labels = "Russet Burbank, 20% Nitrogen", vjust = 1)

# 3 stack for G2, N2
FW_N2_G2_barstack_noR1 <- plot_grid(FW_N2_G2_shoot_bar_noR1 + theme(axis.title.y = element_blank()),
                                    FW_N2_G2_root_bar_noR1 + theme(axis.title.y = element_blank()),
                                    FW_N2_G2_tuber_bar_noR1 + theme(axis.title.y = element_blank()),
                                    nrow = 3, align = "v", labels = "Red La Soda, 20% Nitrogen", vjust = 1)

# G1 and G2, Low N
FW_N2_G1_and_G2_noR1 <- plot_grid(FW_N2_G1_barstack_noR1, FW_N2_G2_barstack_noR1, nrow = 1)
FW_N2_G1_and_G2_noR1

```

#### Cowplot side by side
```{r}
Fig2.N2.grid <- plot_grid(Fig2.B_shoot + theme(legend.position = "none"),
                          Fig2.B_root + theme(legend.position = "none"),
                          Fig2.B_tuber + theme(legend.position = "none"),
                          ncol = 3,
                          labels = c("D", "E", "F"),
                          label_size = 18)
Fig2.N2.grid
```

## Tuber Number

> Tuber number response to treatments

## High N, G1

##### Compute stats for plotting

> n=4

```{r}
stat_N1_G1_tub_num <- summarise(N1_G1_tub_num, Genotype = "G1", N=length(N_tubers), Average=mean(N_tubers, na.rm = TRUE), CI95=conf_int95(N_tubers), SE=std_error(N_tubers))

#stat_N1_G1_tub_num <- unite(stat_N1_G1_tub_num, "Trt", c("Genotype", "N.level", "Inoculation"), sep = ".")
```

##### Bar Plot
```{r, fig.width = 10}
# ggplot with bars

N1_G1_tub_num_control <- stat_N1_G1_tub_num[7,4] # set the control value for Genotype2 (RLS)

# calculate % control for each treatment

## Store control inouclation values for each genotype
stat_N1_G1_tub_num$control <- as.numeric(N1_G1_tub_num_control)

## add a column with the control value for Genotype 2 to each record in the data frame.
stat_N1_G1_tub_num <- stat_N1_G1_tub_num %>% mutate(p_ctrl = (100*(Average / control)))

N1_G1_tub_num_bar <- ggplot(stat_N1_G1_tub_num, aes(x = Inoculation, y = Average))
N1_G1_tub_num_bar <- N1_G1_tub_num_bar + geom_bar(stat = "identity", size=.5, fill="lightgreen")
N1_G1_tub_num_bar <- N1_G1_tub_num_bar + geom_hline(aes(yintercept=stat_N1_G1_tub_num$control), colour="purple2", linetype="dashed")
N1_G1_tub_num_bar <- N1_G1_tub_num_bar + labs(x="", y="Number of Tubers")
N1_G1_tub_num_bar <- N1_G1_tub_num_bar + geom_errorbar(aes(ymin=Average-SE, ymax=Average+SE), size=.5, width=.2)
N1_G1_tub_num_bar <- N1_G1_tub_num_bar + theme(
  axis.text.x = element_text(angle = 60, hjust = 1, size = 12),
  axis.text.y = element_text(size = 12),
  axis.title.x = element_blank(),
  axis.title.y = element_text(size = 14),
  legend.text = element_text(size = 16),
  legend.title = element_text(size = 16))
N1_G1_tub_num_bar <- N1_G1_tub_num_bar + scale_x_discrete(position = "bottom", expand = c(0,0))
N1_G1_tub_num_bar <- N1_G1_tub_num_bar + scale_y_continuous(expand = c(0,0), limits = c(0,12))
N1_G1_tub_num_bar
```


## High N, G2
##### Compute stats for plotting

> n=4

```{r}
stat_N1_G2_tub_num <- summarise(N1_G2_tub_num, Genotype = "G2", N=length(N_tubers), Average=mean(N_tubers, na.rm = TRUE), CI95=conf_int95(N_tubers), SE=std_error(N_tubers))

#stat_N1_G2_tub_num <- unite(stat_N1_G2_tub_num, "Trt", c("Genotype", "N.level", "Inoculation"), sep = ".")
```

##### Bar Plot
```{r, fig.width = 10}
# ggplot with bars

N1_G2_tub_num_control <- stat_N1_G2_tub_num[7,4] # set the control value for Genotype2 (RLS)

# calculate % control for each treatment

## Store control inouclation values for each genotype
stat_N1_G2_tub_num$control <- as.numeric(N1_G2_tub_num_control)

## add a column with the control value for Genotype 2 to each record in the data frame.
stat_N1_G2_tub_num <- stat_N1_G2_tub_num %>% mutate(p_ctrl = (100*(Average / control)))

N1_G2_tub_num_bar <- ggplot(stat_N1_G2_tub_num, aes(x = Inoculation, y = Average))
N1_G2_tub_num_bar <- N1_G2_tub_num_bar + geom_bar(stat = "identity", size=.5, fill="lightgreen")
N1_G2_tub_num_bar <- N1_G2_tub_num_bar + geom_hline(aes(yintercept=stat_N1_G2_tub_num$control), colour="purple2", linetype="dashed")
N1_G2_tub_num_bar <- N1_G2_tub_num_bar + labs(x="", y="Number of Tubers")
N1_G2_tub_num_bar <- N1_G2_tub_num_bar + geom_errorbar(aes(ymin=Average-SE, ymax=Average+SE), size=.5, width=.2)
N1_G2_tub_num_bar <- N1_G2_tub_num_bar + theme(
  axis.text.x = element_text(angle = 0, size = 12),
  axis.text.y = element_text(size = 12),
  axis.title.x = element_blank(),
  axis.title.y = element_text(size = 14),
  legend.text = element_text(size = 16),
  legend.title = element_text(size = 16))
N1_G2_tub_num_bar <- N1_G2_tub_num_bar + scale_x_discrete(position = "bottom", expand = c(0,0))
N1_G2_tub_num_bar <- N1_G2_tub_num_bar + scale_y_continuous(expand = c(0,0), limits = c(0,10))

# significance table
N1_G2_tub_num_bar_label.df <- data.frame(Inoculation = c("F"),
                                          Average = c(9.5))

N1_G2_tub_num_bar <- N1_G2_tub_num_bar + geom_text(data = N1_G2_tub_num_bar_label.df, label = "*", size = 14)

N1_G2_tub_num_bar
```

### Hi N - Plot both G1 and G2 together
```{r}
# create bound dataframe
stat_N1_G1_and_G2_tub_num <- rbind(stat_N1_G1_tub_num, stat_N1_G2_tub_num)
#View(stat_N1_G1_and_G2_tub_num)

# plot
N1_G1_and_G2_tub_num_bar <- ggplot(stat_N1_G1_and_G2_tub_num, aes(x = Inoculation, y = Average, fill = Genotype))
N1_G1_and_G2_tub_num_bar <- N1_G1_and_G2_tub_num_bar + geom_bar(stat = "identity", size=.3, position = position_dodge(.9))
N1_G1_and_G2_tub_num_bar <- N1_G1_and_G2_tub_num_bar + labs(y="Number of Tubers")# +
#  ggtitle("100% Nitrogen") + theme(plot.title = element_text(hjust = 0.5))
N1_G1_and_G2_tub_num_bar <- N1_G1_and_G2_tub_num_bar + scale_fill_manual(labels = c("Russet Burbank", "Red La Soda"), values = c("tan2", "indianred3"))
N1_G1_and_G2_tub_num_bar <- N1_G1_and_G2_tub_num_bar + geom_errorbar(aes(ymin=Average-SE, ymax=Average+SE), size=.4, width=.4, position = position_dodge(.9))
N1_G1_and_G2_tub_num_bar <- N1_G1_and_G2_tub_num_bar + theme(
  axis.text.x = element_text(angle = 30, size = 12, hjust = 1),
  axis.text.y = element_text(size = 12),
  axis.title.x = element_blank(),
  axis.title.y = element_text(size = 14),
  legend.text = element_text(size = 16),
  legend.title = element_text(size = 16),
  legend.position = "bottom")
N1_G1_and_G2_tub_num_bar <- N1_G1_and_G2_tub_num_bar + scale_x_discrete(labels = Fig2.x.labels)
N1_G1_and_G2_tub_num_bar <- N1_G1_and_G2_tub_num_bar + scale_y_continuous(expand = c(0,0), limits = c(0,11.5))

# significance table
N1_G1_and_G2_tub_num_bar_label.df <- data.frame(Inoculation = c("F"), Genotype = c("G2"), Average = c(9.5))

N1_G1_and_G2_tub_num_bar <- N1_G1_and_G2_tub_num_bar + geom_text(data = N1_G1_and_G2_tub_num_bar_label.df, label = "*", size = 14, hjust = -0.22)

N1_G1_and_G2_tub_num_bar
```


## Low N, G1
##### Compute stats for plotting

> n=4

```{r}
stat_N2_G1_tub_num <- summarise(N2_G1_tub_num, Genotype = "G1", N=length(N_tubers), Average=mean(N_tubers, na.rm = TRUE), CI95=conf_int95(N_tubers), SE=std_error(N_tubers))

#stat_N2_G1_tub_num <- unite(stat_N2_G1_tub_num, "Trt", c("Genotype", "N.level", "Inoculation"), sep = ".")
```

##### Bar Plot
```{r, fig.width = 10}
# ggplot with bars

N2_G1_tub_num_control <- stat_N2_G1_tub_num[7,4] # set the control value for Genotype2 (RLS)

# calculate % control for each treatment

## Store control inouclation values for each genotype
stat_N2_G1_tub_num$control <- as.numeric(N2_G1_tub_num_control)

## add a column with the control value for Genotype 2 to each record in the data frame.
stat_N2_G1_tub_num <- stat_N2_G1_tub_num %>% mutate(p_ctrl = (100*(Average / control)))

N2_G1_tub_num_bar <- ggplot(stat_N2_G1_tub_num, aes(x = Inoculation, y = Average))
N2_G1_tub_num_bar <- N2_G1_tub_num_bar + geom_bar(stat = "identity", size=.5, fill="lightgreen")
N2_G1_tub_num_bar <- N2_G1_tub_num_bar + geom_hline(aes(yintercept=stat_N2_G1_tub_num$control), colour="purple2", linetype="dashed")
N2_G1_tub_num_bar <- N2_G1_tub_num_bar + labs(x="", y="Number of Tubers")
N2_G1_tub_num_bar <- N2_G1_tub_num_bar + geom_errorbar(aes(ymin=Average-SE, ymax=Average+SE), size=.5, width=.2)
N2_G1_tub_num_bar <- N2_G1_tub_num_bar + theme(
  axis.text.x = element_text(angle = 60, hjust = 1, size = 12),
  axis.text.y = element_text(size = 12),
  axis.title.x = element_blank(),
  axis.title.y = element_text(size = 14),
  legend.text = element_text(size = 16),
  legend.title = element_text(size = 16))
N2_G1_tub_num_bar <- N2_G1_tub_num_bar + scale_x_discrete(position = "bottom", expand = c(0,0))
N2_G1_tub_num_bar <- N2_G1_tub_num_bar + scale_y_continuous(expand = c(0,0), limits = c(0,12))
N2_G1_tub_num_bar
```

## Low N, G2
##### Compute stats for plotting

> n=4

```{r}
stat_N2_G2_tub_num <- summarise(N2_G2_tub_num, Genotype = "G2", N=length(N_tubers), Average=mean(N_tubers, na.rm = TRUE), CI95=conf_int95(N_tubers), SE=std_error(N_tubers))

#stat_N2_G2_tub_num <- unite(stat_N2_G2_tub_num, "Trt", c("Genotype", "N.level", "Inoculation"), sep = ".")
```

##### Bar Plot
```{r, fig.width = 10}
# ggplot with bars

N2_G2_tub_num_control <- stat_N2_G2_tub_num[7,4] # set the control value for Genotype2 (RLS)

# calculate % control for each treatment

## Store control inouclation values for each genotype
stat_N2_G2_tub_num$control <- as.numeric(N2_G2_tub_num_control)

## add a column with the control value for Genotype 2 to each record in the data frame.
stat_N2_G2_tub_num <- stat_N2_G2_tub_num %>% mutate(p_ctrl = (100*(Average / control)))

N2_G2_tub_num_bar <- ggplot(stat_N2_G2_tub_num, aes(x = Inoculation, y = Average))
N2_G2_tub_num_bar <- N2_G2_tub_num_bar + geom_bar(stat = "identity", size=.5, fill="lightgreen")
N2_G2_tub_num_bar <- N2_G2_tub_num_bar + geom_hline(aes(yintercept=stat_N2_G2_tub_num$control), colour="purple2", linetype="dashed")
N2_G2_tub_num_bar <- N2_G2_tub_num_bar + labs(x="", y="Number of Tubers")
N2_G2_tub_num_bar <- N2_G2_tub_num_bar + geom_errorbar(aes(ymin=Average-SE, ymax=Average+SE), size=.5, width=.2)
N2_G2_tub_num_bar <- N2_G2_tub_num_bar + theme(
  axis.text.x = element_text(angle = 45, hjust = 1, size = 12),
  axis.text.y = element_text(size = 12),
  axis.title.x = element_blank(),
  axis.title.y = element_text(size = 14),
  legend.text = element_text(size = 16),
  legend.title = element_text(size = 16))
N2_G2_tub_num_bar <- N2_G2_tub_num_bar + scale_x_discrete(position = "bottom", expand = c(0,0))
N2_G2_tub_num_bar <- N2_G2_tub_num_bar + scale_y_continuous(expand = c(0,0), limits = c(0,10))
N2_G2_tub_num_bar
```

### Low N - Plot both G1 and G2 together
```{r}
# create bound dataframe
stat_N2_G1_and_G2_tub_num <- rbind(stat_N2_G1_tub_num, stat_N2_G2_tub_num)
#View(stat_N1_G1_and_G2_tub_num)

# plot
N2_G1_and_G2_tub_num_bar <- ggplot(stat_N2_G1_and_G2_tub_num, aes(x = Inoculation, y = Average, fill = Genotype))
N2_G1_and_G2_tub_num_bar <- N2_G1_and_G2_tub_num_bar + geom_bar(stat = "identity", size=.3, position = position_dodge(.9))
N2_G1_and_G2_tub_num_bar <- N2_G1_and_G2_tub_num_bar + labs(y="Number of Tubers")# +
  #ggtitle("20% Nitrogen") + theme(plot.title = element_text(hjust = 0.5))
N2_G1_and_G2_tub_num_bar <- N2_G1_and_G2_tub_num_bar + scale_fill_manual(labels = c("Russet Burbank", "Red La Soda"), values = c("tan2", "indianred3"))
N2_G1_and_G2_tub_num_bar <- N2_G1_and_G2_tub_num_bar + geom_errorbar(aes(ymin=Average-SE, ymax=Average+SE), size=.4, width=.4, position = position_dodge(.9))
N2_G1_and_G2_tub_num_bar <- N2_G1_and_G2_tub_num_bar + theme(
  axis.text.x = element_text(angle = 30, size = 12, hjust = 1),
  axis.text.y = element_text(size = 12),
  axis.title.x = element_blank(),
  axis.title.y = element_text(size = 14),
  legend.text = element_text(size = 24),
  legend.title = element_text(size = 26, face = "bold"),
  legend.key.size = unit(2, "cm"),
  legend.position = "right")
N2_G1_and_G2_tub_num_bar <- N2_G1_and_G2_tub_num_bar + scale_x_discrete(labels = Fig2.x.labels, position = "bottom", expand = c(0,0))
N2_G1_and_G2_tub_num_bar <- N2_G1_and_G2_tub_num_bar + scale_y_continuous(expand = c(0,0), limits = c(0,9))
N2_G1_and_G2_tub_num_bar
```

### Cowplot 1
```{r}
# extract legend
nit_hi_lo_leg <- get_legend(N2_G1_and_G2_tub_num_bar)


nitrogen_hi_lo_n_tub <- plot_grid(N1_G1_and_G2_tub_num_bar + theme(legend.position = "none"),
                                  N2_G1_and_G2_tub_num_bar + theme(legend.position = "none"),
                                  nit_hi_lo_leg,
                                  nrow = 1,
                                  labels = c("G", "H", ""),
                                  label_size = 18)


#nitrogen_hi_lo_n_tub_all <- plot_grid(nitrogen_hi_lo_n_tub, nit_hi_lo_leg, ncol = 1, rel_heights = c(1, 0.1))

nitrogen_hi_lo_n_tub


```

## Fig 2 Grid - MS2-S17 Fig
```{r}
Fig2_grid <- plot_grid(Fig2.N1.grid,
                       Fig2.N2.grid,
                       nitrogen_hi_lo_n_tub,
                       ncol = 1)
Fig2_grid

ggsave("./Plots/MS2-SFig17.pdf", Fig2_grid, width = 16, height = 18)
```

## Fig 2

### Fig 2 Tub Num Plot

> Re-Plot Tuber Number for N1, G1, G2 with adjusted asterisk position to indicate significance in cowplot

```{r}
# plot
Fig2C_tub_num_bar <- ggplot(stat_N1_G1_and_G2_tub_num, aes(x = Inoculation, y = Average, fill = Genotype))
Fig2C_tub_num_bar <- Fig2C_tub_num_bar + geom_bar(stat = "identity", size=.3, position = position_dodge(.9))
Fig2C_tub_num_bar <- Fig2C_tub_num_bar + labs(y="Number of Tubers")# +
#  ggtitle("100% Nitrogen") + theme(plot.title = element_text(hjust = 0.5))
Fig2C_tub_num_bar <- Fig2C_tub_num_bar + scale_fill_manual(labels = c("Russet Burbank", "Red La Soda"), values = c("tan2", "indianred3"))
Fig2C_tub_num_bar <- Fig2C_tub_num_bar + geom_errorbar(aes(ymin=Average-SE, ymax=Average+SE), size=.4, width=.4, position = position_dodge(.9))
Fig2C_tub_num_bar <- Fig2C_tub_num_bar + theme(
  axis.text.x = element_text(angle = 30, size = 12, hjust = 1),
  axis.text.y = element_text(size = 12),
  axis.title.x = element_blank(),
  axis.title.y = element_text(size = 14),
  legend.text = element_text(size = 16),
  legend.title = element_text(size = 16),
  legend.position = "bottom")
Fig2C_tub_num_bar <- Fig2C_tub_num_bar + scale_x_discrete(labels = Fig2.x.labels)
Fig2C_tub_num_bar <- Fig2C_tub_num_bar + scale_y_continuous(expand = c(0,0), limits = c(0,11.5))

# significance table
Fig2C_tub_num_bar_label.df <- data.frame(Inoculation = c("F"), Genotype = c("G2"), Average = c(9.5))

Fig2C_tub_num_bar <- Fig2C_tub_num_bar + geom_text(data = Fig2C_tub_num_bar_label.df, label = "*", size = 14, hjust = -1.85)

Fig2C_tub_num_bar
```

### Fig 2 Tables
```{r}
library(gridExtra)

pool.specs <- read.csv("./pool-specs.csv", header = T, colClasses = "character", row.names = 1, check.names = F)

pool.design <- read.csv("./pool-design.csv", header = T, colClasses = "character", row.names = 1, check.names = F)

# make table objects for plot

pSpecs <- tableGrob(pool.specs)
pDesign <- tableGrob(pool.design)

grid.arrange(
  pSpecs,
  pDesign,
  ncol = 1,
  nrow = 2,
  clip = FALSE
)

Fig2.tables <- plot_grid(as_grob(pSpecs),
                  as_grob(pDesign),
                  ncol = 2,
                  align = 'h',
                  labels = c("A", "B"),
                  label_size = 18)

Fig2.grid <- plot_grid(Fig2.tables,
                       Fig2C_tub_num_bar + theme_cowplot() + 
                         theme(axis.title.x = element_blank(),
                               legend.position = "bottom",
                               legend.title = element_text(size = 16, face = "bold"),
                               legend.text = element_text(size = 14)
                               ),
                       nrow = 2,
                       align = 'h',
                       labels = c("", "C"),
                       label_size = 18)
Fig2.grid

ggsave("./Plots/MS2-Fig2.pdf", Fig2.grid, width = 17, height = 8)

## save for publication
ggsave("./Plots/Fig2-pub.tiff",
       Fig2.grid,
       device = "tiff",
       units = "in",
       width = 17,
       height = 7,
       dpi = 300,
       compression = "lzw+p")


```

